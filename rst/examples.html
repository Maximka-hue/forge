

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; Forge 1.0.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/arrayfire.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Interop Helpers" href="extras.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #073763" >
          

          
            <a href="../index.html" class="icon icon-home"> Forge
          

          
            
            <img src="../_static/arrayfire_icon.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../markdown/README.html">Overview {#mainpage}</a></li>
<li class="toctree-l1"><a class="reference internal" href="samples.html">Sample Renderings</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="forge.html">Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="enums.html">C API Enums</a></li>
<li class="toctree-l1"><a class="reference internal" href="typedefs.html">C API typdefs</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="macros.html">Macros</a></li>
</ul>
<p class="caption"><span class="caption-text">Extras</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="extras.html">Interop Helpers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#image-rendering">Image Rendering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cpu">CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cuda">CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opencl">OpenCL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bubblechart-with-transparency">Bubblechart with Transparency</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">OpenCL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#d-vector-field">2D Vector Field</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">OpenCL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#histogram">Histogram</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">OpenCL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#d-line-plot">3D Line Plot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">OpenCL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-line-plots">Multiple line plots</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">OpenCL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#d-vector-stream">3D Vector Stream</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id16">CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id17">CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id18">OpenCL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#surfaces">Surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id19">CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">OpenCL</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Forge</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/rst/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="image-rendering">
<h2>Image Rendering<a class="headerlink" href="#image-rendering" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cpu">
<h3>CPU<a class="headerlink" href="#cpu" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CPU_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Bitmap</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">height</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Bitmap</span> <span class="nf">createBitmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">w</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">h</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">destroyBitmap</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">julia</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Bitmap</span> <span class="n">bmp</span> <span class="o">=</span> <span class="n">createBitmap</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Fractal Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="cm">/* create an font object and load necessary font</span>
<span class="cm">     * and later pass it on to window object so that</span>
<span class="cm">     * it can be used for rendering text</span>
<span class="cm">     *</span>
<span class="cm">     * NOTE: THIS IS OPTIONAL STEP, BY DEFAULT WINDOW WILL</span>
<span class="cm">     * HAVE FONT ALREADY SETUP*/</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Font</span> <span class="n">fnt</span><span class="p">;</span>
<span class="cp">#if defined(OS_WIN)</span>
    <span class="n">fnt</span><span class="p">.</span><span class="n">loadSystemFont</span><span class="p">(</span><span class="s">&quot;Calibri&quot;</span><span class="p">);</span>
<span class="cp">#else</span>
    <span class="n">fnt</span><span class="p">.</span><span class="n">loadSystemFont</span><span class="p">(</span><span class="s">&quot;Vera&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">setFont</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fnt</span><span class="p">);</span>

    <span class="cm">/* Create an image object which creates the necessary</span>
<span class="cm">     * textures and pixel buffer objects to hold the image</span>
<span class="cm">     * */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Image</span> <span class="n">img</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="n">FG_RGBA</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u8</span><span class="p">);</span>
    <span class="cm">/* copy your data into the pixel buffer object exposed by</span>
<span class="cm">     * forge::Image class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>
    <span class="n">kernel</span><span class="p">(</span><span class="n">bmp</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// create GL-CPU interop buffer</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">pixels</span><span class="p">(),</span> <span class="n">FORGE_IMAGE_BUFFER</span><span class="p">);</span>

    <span class="c1">// copy the data from compute buffer to graphics buffer</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="c1">// destroy GL-CPU Interop buffer</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
    <span class="n">destroyBitmap</span><span class="p">(</span><span class="n">bmp</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Bitmap</span> <span class="nf">createBitmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">w</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Bitmap</span> <span class="n">retVal</span><span class="p">;</span>
    <span class="n">retVal</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
    <span class="n">retVal</span><span class="p">.</span><span class="n">height</span><span class="o">=</span> <span class="n">h</span><span class="p">;</span>
    <span class="n">retVal</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="k">new</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">retVal</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">destroyBitmap</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">bmp</span><span class="p">.</span><span class="n">height</span><span class="p">;</span> <span class="o">++</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">offset</span>  <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">juliaVal</span><span class="o">=</span> <span class="n">julia</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">bmp</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
            <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">juliaVal</span><span class="p">;</span>
            <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">julia</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">jx</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0f</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mf">2.0f</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">jy</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">height</span><span class="o">/</span><span class="mf">2.0f</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mf">2.0f</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">c</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8f</span><span class="p">,</span> <span class="mf">0.156f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">(</span><span class="n">jx</span><span class="p">,</span> <span class="n">jy</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">200</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="cuda">
<h3>CUDA<a class="headerlink" href="#cuda" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuda_runtime.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuComplex.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CUDA_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">size_t</span>   <span class="n">TOT_SIZE</span> <span class="o">=</span> <span class="n">DIMX</span><span class="o">*</span><span class="n">DIMY</span><span class="o">*</span><span class="mi">4</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dev_out</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Fractal Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="cm">/* Create an image object which creates the necessary</span>
<span class="cm">     * textures and pixel buffer objects to hold the image</span>
<span class="cm">     * */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Image</span> <span class="n">img</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="n">FG_RGBA</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u8</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// create GL-CPU interop buffer</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">pixels</span><span class="p">(),</span> <span class="n">FORGE_IMAGE_BUFFER</span><span class="p">);</span>

    <span class="cm">/* copy your data into the pixel buffer object exposed by</span>
<span class="cm">     * forge::Image class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">TOT_SIZE</span><span class="p">));</span>
    <span class="n">kernel</span><span class="p">(</span><span class="n">dev_out</span><span class="p">);</span>

    <span class="c1">// copy the data from compute buffer to graphics buffer</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="c1">// destroy GL-CPU Interop buffer</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">dev_out</span><span class="p">));</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__device__</span>
<span class="kt">int</span> <span class="nf">julia</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
<span class="p">{</span>

    <span class="k">const</span> <span class="kt">float</span> <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">jx</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">DIMX</span><span class="o">/</span><span class="mf">2.0f</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">DIMX</span><span class="o">/</span><span class="mf">2.0f</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">jy</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">DIMY</span><span class="o">/</span><span class="mf">2.0f</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">DIMY</span><span class="o">/</span><span class="mf">2.0f</span><span class="p">);</span>

    <span class="n">cuFloatComplex</span> <span class="n">c</span> <span class="o">=</span> <span class="n">make_cuFloatComplex</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8f</span><span class="p">,</span> <span class="mf">0.156f</span><span class="p">);</span>
    <span class="n">cuFloatComplex</span> <span class="n">a</span> <span class="o">=</span> <span class="n">make_cuFloatComplex</span><span class="p">(</span><span class="n">jx</span><span class="p">,</span> <span class="n">jy</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">200</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">cuCaddf</span><span class="p">(</span><span class="n">cuCmulf</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">c</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cuCabsf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1000.0f</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">julia</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">out</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">DIMX</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">DIMY</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">DIMX</span><span class="p">;</span>
        <span class="c1">// now calculate the value at that position</span>
        <span class="kt">int</span> <span class="n">juliaValue</span> <span class="o">=</span> <span class="n">julia</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>

        <span class="n">out</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">juliaValue</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="n">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
                <span class="n">divup</span><span class="p">(</span><span class="n">DIMY</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>

    <span class="n">julia</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">dev_out</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="opencl">
<h3>OpenCL<a class="headerlink" href="#opencl" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cl_helpers.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;mutex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">cl</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">IMG_SIZE</span> <span class="o">=</span> <span class="n">DIMX</span> <span class="o">*</span> <span class="n">DIMY</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>

<span class="cp">#define USE_FORGE_OPENCL_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">fractal_ocl_kernel</span> <span class="o">=</span>
<span class="s">&quot;float magnitude(float2 a)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;{</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    return sqrt(a.s0*a.s0+a.s1*a.s1);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;float2 mul(float2 a, float2 b)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;{</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    return (float2)(a.s0*b.s0-a.s1*b.s1, a.s1*b.s0+a.s0*b.s1);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;float2 add(float2 a, float2 b)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;{</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    return (float2)(a.s0+b.s0, a.s1+b.s1);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;int pixel(int x, int y, int width, int height)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;{</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    const float scale = 1.5;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    float jx = scale * (float)(width/2.0f - x)/(width/2.0f);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    float jy = scale * (float)(height/2.0f - y)/(height/2.0f);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    float2 c = (float2)(-0.8f, 0.156f);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    float2 a = (float2)(jx, jy);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    for (int i=0; i&lt;200; i++) {</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;        a = add(mul(a, a), c);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;        if (magnitude(a) &gt; 1000.0f)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;            return 0;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    }</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    return 1;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;kernel</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;void julia(global unsigned char* out, const unsigned w, const unsigned h)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;{</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    int x = get_group_id(0) * get_local_size(0) + get_local_id(0);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    int y = get_group_id(1) * get_local_size(1) + get_local_id(1);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    if (x&lt;w &amp;&amp; y&lt;h) {</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;        int offset        = x + y * w;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;        int juliaValue    = pixel(x, y, w, h);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;        out[offset*4 + 1] = 255 * juliaValue;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;        out[offset*4 + 0] = 0;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;        out[offset*4 + 2] = 0;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;        out[offset*4 + 3] = 255;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    }</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">devOut</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="o">&amp;</span> <span class="n">queue</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">once_flag</span>   <span class="n">compileFlag</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span>      <span class="n">prog</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>       <span class="n">kern</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">call_once</span><span class="p">(</span><span class="n">compileFlag</span><span class="p">,</span>
        <span class="p">[</span><span class="n">queue</span><span class="p">]()</span> <span class="p">{</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_QUEUE_CONTEXT</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">fractal_ocl_kernel</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
            <span class="n">kern</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;julia&quot;</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="k">auto</span> <span class="n">juliaOp</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">KernelFunctor</span><span class="o">&lt;</span><span class="n">Buffer</span><span class="p">,</span> <span class="kt">unsigned</span><span class="p">,</span> <span class="kt">unsigned</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kern</span><span class="p">);</span>

    <span class="k">static</span> <span class="k">const</span> <span class="n">NDRange</span> <span class="n">local</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">NDRange</span> <span class="n">global</span><span class="p">(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">divup</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                   <span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">divup</span><span class="p">(</span><span class="n">DIMY</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">])));</span>

    <span class="n">juliaOp</span><span class="p">(</span><span class="n">EnqueueArgs</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">),</span> <span class="n">devOut</span><span class="p">,</span> <span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>

        <span class="cm">/*</span>
<span class="cm">        * First Forge call should be a window creation call</span>
<span class="cm">        * so that necessary OpenGL context is created for any</span>
<span class="cm">        * other forge::* object to be created successfully</span>
<span class="cm">        */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Fractal Demo&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

        <span class="cm">/* Create an image object which creates the necessary</span>
<span class="cm">        * textures and pixel buffer objects to hold the image</span>
<span class="cm">        * */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Image</span> <span class="n">img</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="n">FG_RGBA</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u8</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Helper function to create a CLGL interop context.</span>
<span class="cm">         * This function checks for if the extension is available</span>
<span class="cm">         * and creates the context on the appropriate device.</span>
<span class="cm">         * Note: context and queue are defined in cl_helpers.h</span>
<span class="cm">         */</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">createCLGLContext</span><span class="p">(</span><span class="n">wnd</span><span class="p">);</span>
        <span class="n">Device</span> <span class="n">device</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_CONTEXT_DEVICES</span><span class="o">&gt;</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="cm">/* copy your data into the pixel buffer object exposed by</span>
<span class="cm">         * forge::Image class and then proceed to rendering.</span>
<span class="cm">         * To help the users with copying the data from compute</span>
<span class="cm">         * memory to display memory, Forge provides copy headers</span>
<span class="cm">         * along with the library to help with this task</span>
<span class="cm">         */</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">devOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">);</span>

        <span class="n">kernel</span><span class="p">(</span><span class="n">devOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">);</span>

        <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="c1">// create GL-CPU interop buffer</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">pixels</span><span class="p">(),</span> <span class="n">FORGE_IMAGE_BUFFER</span><span class="p">);</span>

        <span class="c1">// copy the data from compute buffer to graphics buffer</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">devOut</span><span class="p">(),</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">img</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

        <span class="c1">// destroy GL-CPU Interop buffer</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">forge</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="bubblechart-with-transparency">
<h2>Bubblechart with Transparency<a class="headerlink" href="#bubblechart-with-transparency" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>CPU<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CPU_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">FRANGE_START</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">FRANGE_END</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="mf">3.1415926f</span><span class="p">;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">map_range_to_vec_vbo</span><span class="p">(</span><span class="kt">float</span> <span class="n">range_start</span><span class="p">,</span> <span class="kt">float</span> <span class="n">range_end</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dx</span><span class="p">,</span>
                          <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">vec</span><span class="p">,</span>
                          <span class="kt">float</span> <span class="p">(</span><span class="o">*</span><span class="n">map</span><span class="p">)</span> <span class="p">(</span><span class="kt">float</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">range_start</span> <span class="o">&gt;</span> <span class="n">range_end</span> <span class="o">&amp;&amp;</span> <span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">i</span><span class="o">=</span><span class="n">range_start</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">range_end</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="n">dx</span><span class="p">){</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="o">*</span><span class="n">map</span><span class="p">)(</span><span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">cosData</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">tanData</span><span class="p">;</span>

    <span class="n">map_range_to_vec_vbo</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="n">cosData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cosf</span><span class="p">);</span>
    <span class="n">map_range_to_vec_vbo</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="n">tanData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tanf</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">random_device</span> <span class="n">r</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">default_random_engine</span> <span class="n">e1</span><span class="p">(</span><span class="n">r</span><span class="p">());</span>
    <span class="n">std</span><span class="o">::</span><span class="n">mt19937_64</span> <span class="n">gen</span><span class="p">(</span><span class="n">r</span><span class="p">());</span>

    <span class="n">std</span><span class="o">::</span><span class="n">uniform_real_distribution</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">nDist</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">uniform_real_distribution</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">cDist</span><span class="p">(</span><span class="mf">0.2f</span><span class="p">,</span> <span class="mf">0.6f</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">uniform_real_distribution</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">fDist</span><span class="p">(</span><span class="mf">0.4f</span><span class="p">,</span> <span class="mf">0.6f</span><span class="p">);</span>

    <span class="k">auto</span> <span class="n">clr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">cDist</span><span class="p">,</span> <span class="n">gen</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">rnd</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">nDist</span><span class="p">,</span> <span class="n">e1</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">alp</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">fDist</span><span class="p">,</span> <span class="n">gen</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">colors</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">tanData</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">alphas</span><span class="p">(</span><span class="n">tanData</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">radii</span><span class="p">(</span><span class="n">tanData</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

    <span class="n">std</span><span class="o">::</span><span class="n">generate</span><span class="p">(</span><span class="n">colors</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">colors</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">clr</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">generate</span><span class="p">(</span><span class="n">radii</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">radii</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">rnd</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">generate</span><span class="p">(</span><span class="n">alphas</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">alphas</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">alp</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Bubble chart with Transparency Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="cm">/* Create several plot objects which creates the necessary</span>
<span class="cm">     * vertex buffer objects to hold the different plot types</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt1</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">cosData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span>
                               <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_TRIANGLE</span><span class="p">);</span> <span class="c1">//or specify a specific plot type</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt2</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">tanData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span>
                               <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_CIRCLE</span><span class="p">);</span> <span class="c1">//last parameter specifies marker shape</span>

    <span class="cm">/* Set plot colors */</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_RED</span><span class="p">);</span>
    <span class="n">plt2</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_GREEN</span><span class="p">);</span>            <span class="c1">//use a forge predefined color</span>
    <span class="cm">/* Set plot legends */</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Cosine&quot;</span><span class="p">);</span>
    <span class="n">plt2</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Tangent&quot;</span><span class="p">);</span>
    <span class="cm">/* set plot global marker size */</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setMarkerSize</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
    <span class="cm">/* copy your data into the opengl buffer object exposed by</span>
<span class="cm">     * forge::Plot class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

    <span class="c1">// create GL-CPU interop buffers</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plt1</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">alphas</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">radii</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="c1">// copy the data from compute buffer to graphics buffer</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">cosData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt1</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">tanData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="cm">/* update color value for tan graph */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">colors</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>
    <span class="cm">/* update alpha values for tan graph */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">alphas</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">alphasSize</span><span class="p">());</span>
    <span class="cm">/* update marker sizes for tan graph markers */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">radii</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">radiiSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="c1">// destroy GL-CPU Interop buffer</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id2">
<h3>CUDA<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuda_runtime.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;curand.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;curand_kernel.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CUDA_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>  <span class="n">DX</span> <span class="o">=</span> <span class="mf">0.1f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>  <span class="n">FRANGE_START</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>  <span class="n">FRANGE_END</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">3.141592f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">DATA_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)((</span><span class="n">FRANGE_END</span> <span class="o">-</span> <span class="n">FRANGE_START</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span><span class="p">);</span>

<span class="n">curandState_t</span><span class="o">*</span> <span class="n">state</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">,</span> <span class="kt">int</span> <span class="n">functionCode</span><span class="p">,</span>
            <span class="kt">float</span><span class="o">*</span> <span class="n">colors</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">alphas</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">radii</span><span class="p">);</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">setupRandomKernel</span><span class="p">(</span><span class="n">curandState</span> <span class="o">*</span><span class="n">states</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">seed</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">curand_init</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">tid</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">state</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">curandState_t</span><span class="p">)));</span>
    <span class="n">setupRandomKernel</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">divup</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span><span class="mi">32</span><span class="p">),</span> <span class="mi">32</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">314567</span><span class="p">);</span>

    <span class="kt">float</span> <span class="o">*</span><span class="n">cos_out</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">tan_out</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">colors_out</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">alphas_out</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">radii_out</span><span class="p">;</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">cos_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tan_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">colors_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">3</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">alphas_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">radii_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span><span class="p">));</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Bubble chart with Transparency Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="cm">/* Create several plot objects which creates the necessary</span>
<span class="cm">     * vertex buffer objects to hold the different plot types</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt1</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_TRIANGLE</span><span class="p">);</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt2</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_CIRCLE</span><span class="p">);</span>

    <span class="cm">/* Set plot colors */</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_RED</span><span class="p">);</span>
    <span class="n">plt2</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_GREEN</span><span class="p">);</span>            <span class="c1">//use a forge predefined color</span>
    <span class="cm">/* Set plot legends */</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Cosine&quot;</span><span class="p">);</span>
    <span class="n">plt2</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Tangent&quot;</span><span class="p">);</span>
    <span class="cm">/* set plot global marker size */</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setMarkerSize</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
    <span class="cm">/* copy your data into the opengl buffer object exposed by</span>
<span class="cm">     * forge::Plot class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

    <span class="c1">// create GL-CUDA interop buffers</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plt1</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">alphas</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">radii</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="n">kernel</span><span class="p">(</span><span class="n">cos_out</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">kernel</span><span class="p">(</span><span class="n">tan_out</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors_out</span><span class="p">,</span> <span class="n">alphas_out</span><span class="p">,</span> <span class="n">radii_out</span><span class="p">);</span>

    <span class="c1">// copy the data from compute buffer to graphics buffer</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">cos_out</span><span class="p">,</span> <span class="n">plt1</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">tan_out</span><span class="p">,</span> <span class="n">plt2</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="cm">/* update color value for tan graph */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">colors_out</span><span class="p">,</span> <span class="n">plt2</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>
    <span class="cm">/* update alpha values for tan graph */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">alphas_out</span><span class="p">,</span> <span class="n">plt2</span><span class="p">.</span><span class="n">alphasSize</span><span class="p">());</span>
    <span class="cm">/* update marker sizes for tan graph markers */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">radii_out</span><span class="p">,</span> <span class="n">plt2</span><span class="p">.</span><span class="n">radiiSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="c1">// destroy GL-CUDA Interop buffer</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
    <span class="c1">// destroy CUDA handles</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">cos_out</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">tan_out</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">colors_out</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">alphas_out</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">radii_out</span><span class="p">));</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">mapKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">out</span><span class="p">,</span> <span class="kt">int</span> <span class="n">functionCode</span><span class="p">,</span> <span class="kt">float</span> <span class="n">frange_start</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dx</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">frange_start</span> <span class="o">+</span> <span class="n">id</span><span class="o">*</span><span class="n">dx</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">y</span><span class="p">;</span>

    <span class="k">switch</span><span class="p">(</span><span class="n">functionCode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="n">y</span> <span class="o">=</span> <span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span> <span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">colorsKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">colors</span><span class="p">,</span> <span class="n">curandState</span> <span class="o">*</span><span class="n">states</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

    <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">curand_uniform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span>
    <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curand_uniform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span>
    <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">curand_uniform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">id</span><span class="p">]);</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">randKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">out</span><span class="p">,</span> <span class="n">curandState</span> <span class="o">*</span><span class="n">states</span><span class="p">,</span> <span class="kt">float</span> <span class="n">min</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">id</span>  <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">out</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">curand_uniform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">id</span><span class="p">])</span><span class="o">*</span><span class="n">scale</span> <span class="o">+</span> <span class="n">min</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">,</span> <span class="kt">int</span> <span class="n">functionCode</span><span class="p">,</span>
            <span class="kt">float</span><span class="o">*</span> <span class="n">colors</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">alphas</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">radii</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="n">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="mi">32</span><span class="p">));</span>

    <span class="n">mapKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">functionCode</span><span class="p">,</span> <span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">DX</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">colorsKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">alphas</span><span class="p">)</span>
        <span class="n">randKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">radii</span><span class="p">)</span>
        <span class="n">randKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">radii</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id3">
<h3>OpenCL<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cl_helpers.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">cl</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>  <span class="n">DX</span> <span class="o">=</span> <span class="mf">0.1f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>  <span class="n">FRANGE_START</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>  <span class="n">FRANGE_END</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">3.141592f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">DATA_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">FRANGE_END</span> <span class="o">-</span> <span class="n">FRANGE_START</span><span class="p">)</span> <span class="o">/</span> <span class="n">DX</span><span class="p">);</span>

<span class="cp">#define USE_FORGE_OPENCL_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">chartKernels</span> <span class="o">=</span>
<span class="sa">R</span><span class="s">&quot;</span><span class="dl">EOK(</span><span class="s"></span>
<span class="s">float rand(int x)</span>
<span class="s">{</span>
<span class="s">    x = (x &lt;&lt; 13) ^ x;</span>
<span class="s">    return ( 1.0 - ( (x * (x * x * 15731 + 789221) + 1376312589) &amp; 0x7fffffff) / 1073741824.0);</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void randKernel(global float* out, unsigned seed, float min, float scale, int DATA_SIZE)</span>
<span class="s">{</span>
<span class="s">    int id = get_global_id(0);</span>
<span class="s">    if (id&lt;DATA_SIZE)</span>
<span class="s">        out[id] = scale * (1+rand(seed*id))/2.0f + min;</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void colorsKernel(global float* out, unsigned rseed, unsigned gseed, unsigned bseed, int DATA_SIZE)</span>
<span class="s">{</span>
<span class="s">    int id = get_global_id(0);</span>
<span class="s">    if (id&lt;DATA_SIZE) {</span>
<span class="s">        out[3*id+0] = (1+rand(rseed * id))/2.0f;</span>
<span class="s">        out[3*id+1] = (1+rand(gseed * id))/2.0f;</span>
<span class="s">        out[3*id+2] = (1+rand(bseed * id))/2.0f;</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void mapKernel(global float* out, int functionCode, float FRANGE_START, float DX, int DATA_SIZE)</span>
<span class="s">{</span>
<span class="s">    int id = get_global_id(0);</span>
<span class="s">    float x = FRANGE_START + id*DX;</span>
<span class="s">    float y;</span>

<span class="s">    switch(functionCode) {</span>
<span class="s">        case 0: y = cos(x); break;</span>
<span class="s">        case 1: y = tan(x); break;</span>
<span class="s">        default: y = sin(x); break;</span>
<span class="s">    }</span>

<span class="s">    if (id&lt;DATA_SIZE) {</span>
<span class="s">        out[2*id+0] = x;</span>
<span class="s">        out[2*id+1] = y;</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="dl">)EOK</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">devOut</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fnCode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">outFlags</span><span class="p">,</span>
            <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">colorsOut</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">alphasOut</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">radiiOut</span><span class="p">,</span>
            <span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="o">&amp;</span> <span class="n">queue</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Device</span><span class="o">&amp;</span> <span class="n">device</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span>      <span class="n">prog</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>       <span class="n">randKernel</span><span class="p">,</span> <span class="n">colorsKernel</span><span class="p">,</span> <span class="n">mapKernel</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">srand</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">std</span><span class="o">::</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">compileFlag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_QUEUE_CONTEXT</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">chartKernels</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cl</span><span class="o">::</span><span class="n">Device</span><span class="o">&gt;</span> <span class="n">devs</span><span class="p">;</span>
            <span class="n">devs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
            <span class="n">prog</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">devs</span><span class="p">);</span>

            <span class="n">randKernel</span>   <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;randKernel&quot;</span><span class="p">);</span>
            <span class="n">colorsKernel</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;colorsKernel&quot;</span><span class="p">);</span>
            <span class="n">mapKernel</span>    <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;mapKernel&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Compile Errors: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">prog</span><span class="p">.</span><span class="n">getBuildInfo</span><span class="o">&lt;</span><span class="n">CL_PROGRAM_BUILD_LOG</span><span class="o">&gt;</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&quot;Kernels compiled successfully&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">const</span> <span class="n">NDRange</span> <span class="n">local</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
    <span class="n">NDRange</span> <span class="n">global</span><span class="p">(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">divup</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">])));</span>

    <span class="n">mapKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devOut</span><span class="p">);</span>
    <span class="n">mapKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fnCode</span><span class="p">);</span>
    <span class="n">mapKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">FRANGE_START</span><span class="p">);</span>
    <span class="n">mapKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">DX</span><span class="p">);</span>
    <span class="n">mapKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">mapKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">outFlags</span> <span class="o">&amp;</span> <span class="mh">0x00000001</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">colorsKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">colorsOut</span><span class="p">);</span>
        <span class="n">colorsKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
        <span class="n">colorsKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
        <span class="n">colorsKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
        <span class="n">colorsKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="p">);</span>
        <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">colorsKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">outFlags</span> <span class="o">&amp;</span> <span class="mh">0x00000002</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">alphasOut</span><span class="p">);</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="p">);</span>
        <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">randKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">outFlags</span> <span class="o">&amp;</span> <span class="mh">0x00000004</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">radiiOut</span><span class="p">);</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">20.0f</span><span class="p">);</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">60.0f</span><span class="p">);</span>
        <span class="n">randKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="p">);</span>
        <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">randKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">         * First Forge call should be a window creation call</span>
<span class="cm">         * so that necessary OpenGL context is created for any</span>
<span class="cm">         * other forge::* object to be created successfully</span>
<span class="cm">         */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Bubble chart with Transparency Demo&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

        <span class="cm">/* Create several plot objects which creates the necessary</span>
<span class="cm">         * vertex buffer objects to hold the different plot types</span>
<span class="cm">         */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt1</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_TRIANGLE</span><span class="p">);</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt2</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_CIRCLE</span><span class="p">);</span>

        <span class="cm">/* Set plot colors */</span>
        <span class="n">plt1</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_RED</span><span class="p">);</span>
        <span class="n">plt2</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_GREEN</span><span class="p">);</span>            <span class="c1">//use a forge predefined color</span>
        <span class="cm">/* Set plot legends */</span>
        <span class="n">plt1</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Cosine&quot;</span><span class="p">);</span>
        <span class="n">plt2</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Tangent&quot;</span><span class="p">);</span>
        <span class="cm">/* set plot global marker size */</span>
        <span class="n">plt1</span><span class="p">.</span><span class="n">setMarkerSize</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Helper function to create a CLGL interop context.</span>
<span class="cm">         * This function checks for if the extension is available</span>
<span class="cm">         * and creates the context on the appropriate device.</span>
<span class="cm">         * Note: context and queue are defined in cl_helpers.h</span>
<span class="cm">         */</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">createCLGLContext</span><span class="p">(</span><span class="n">wnd</span><span class="p">);</span>
        <span class="n">Device</span> <span class="n">device</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_CONTEXT_DEVICES</span><span class="o">&gt;</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

        <span class="c1">// create GL-OpenCL interop buffers</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plt1</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">alphas</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">radii</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">cosOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">tanOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">colorsOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">alphasOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">radiiOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">dummy</span><span class="p">;</span>

        <span class="n">kernel</span><span class="p">(</span><span class="n">cosOut</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>
        <span class="n">kernel</span><span class="p">(</span><span class="n">tanOut</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x00000007</span><span class="p">,</span> <span class="n">colorsOut</span><span class="p">,</span> <span class="n">alphasOut</span><span class="p">,</span> <span class="n">radiiOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="cm">/* copy your data into the opengl buffer object exposed by</span>
<span class="cm">         * forge::Plot class and then proceed to rendering.</span>
<span class="cm">         * To help the users with copying the data from compute</span>
<span class="cm">         * memory to display memory, Forge provides copy headers</span>
<span class="cm">         * along with the library to help with this task</span>
<span class="cm">         */</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">cosOut</span><span class="p">(),</span> <span class="n">plt1</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">tanOut</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

        <span class="cm">/* update color value for tan graph */</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">colorsOut</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>
        <span class="cm">/* update alpha values for tan graph */</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">alphasOut</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">alphasSize</span><span class="p">());</span>
        <span class="cm">/* update marker sizes for tan graph markers */</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">radiiOut</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">radiiSize</span><span class="p">());</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

        <span class="c1">// destroy GL-OpenCL Interop buffer</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>

    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">forge</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="d-vector-field">
<h2>2D Vector Field<a class="headerlink" href="#d-vector-field" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>CPU<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CPU_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MINIMUM</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MAXIMUM</span> <span class="o">=</span> <span class="mf">20.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">STEP</span>    <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">NELEMS</span>  <span class="o">=</span> <span class="p">(</span><span class="n">MAXIMUM</span><span class="o">-</span><span class="n">MINIMUM</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">STEP</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DPOINTS</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">};</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">generatePoints</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">points</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">dirs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">points</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">NELEMS</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">MINIMUM</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">STEP</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NELEMS</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">MINIMUM</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">STEP</span><span class="p">;</span>
            <span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
            <span class="n">dirs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">10.f</span><span class="p">));</span>
            <span class="n">dirs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="mf">10.f</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Vector Field Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span> <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">divPoints</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u32</span><span class="p">,</span> <span class="n">FG_PLOT_SCATTER</span><span class="p">,</span> <span class="n">FG_MARKER_CIRCLE</span><span class="p">);</span>
    <span class="n">divPoints</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.9f</span><span class="p">,</span> <span class="mf">0.9f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>
    <span class="n">divPoints</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Convergence Points&quot;</span><span class="p">);</span>
    <span class="n">divPoints</span><span class="p">.</span><span class="n">setMarkerSize</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">VectorField</span> <span class="n">field</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">vectorField</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
    <span class="n">field</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.6f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">points</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">dirs</span><span class="p">;</span>
    <span class="n">generatePoints</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirs</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">divPoints</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">directions</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">DPOINTS</span><span class="p">,</span> <span class="n">divPoints</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">points</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">field</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dirs</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">field</span><span class="p">.</span><span class="n">directionsSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="c1">// destroy GL-cpu interop buffers</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id5">
<h3>CUDA<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuda_runtime.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CUDA_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="cp">#define PI 3.14159265359</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MINIMUM</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MAXIMUM</span> <span class="o">=</span> <span class="mf">20.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">STEP</span>    <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">NELEMS</span>  <span class="o">=</span> <span class="p">(</span><span class="n">MAXIMUM</span><span class="o">-</span><span class="n">MINIMUM</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">STEP</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DPOINTS</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">};</span>

<span class="kt">void</span> <span class="nf">generatePoints</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">points</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dirs</span><span class="p">);</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span><span class="o">*</span> <span class="n">dpoints</span><span class="p">;</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">points</span><span class="p">;</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">dirs</span><span class="p">;</span>
    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Vector Field Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span> <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">divPoints</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u32</span><span class="p">,</span> <span class="n">FG_PLOT_SCATTER</span><span class="p">,</span> <span class="n">FG_MARKER_CIRCLE</span><span class="p">);</span>
    <span class="n">divPoints</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.9f</span><span class="p">,</span> <span class="mf">0.9f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>
    <span class="n">divPoints</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Convergence Points&quot;</span><span class="p">);</span>
    <span class="n">divPoints</span><span class="p">.</span><span class="n">setMarkerSize</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>

    <span class="kt">size_t</span> <span class="n">npoints</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)(</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">VectorField</span> <span class="n">field</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">vectorField</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">npoints</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
    <span class="n">field</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.6f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dpoints</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">points</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">npoints</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dirs</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">npoints</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">divPoints</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">directions</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMemcpy</span><span class="p">(</span><span class="n">dpoints</span><span class="p">,</span> <span class="n">DPOINTS</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">),</span> <span class="n">cudaMemcpyHostToDevice</span><span class="p">));</span>
    <span class="n">generatePoints</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirs</span><span class="p">);</span>

    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dpoints</span><span class="p">,</span> <span class="n">divPoints</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">points</span><span class="p">,</span> <span class="n">field</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dirs</span><span class="p">,</span> <span class="n">field</span><span class="p">.</span><span class="n">directionsSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="c1">// destroy GL-CUDA interop buffers</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="c1">// destroy CUDA handles</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">dpoints</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">points</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">dirs</span><span class="p">));</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">pointGenKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">points</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dirs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nelems</span><span class="p">,</span> <span class="kt">float</span> <span class="n">minimum</span><span class="p">,</span> <span class="kt">float</span> <span class="n">step</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nelems</span> <span class="o">&amp;&amp;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nelems</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">id</span>  <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">nelems</span><span class="p">;</span>

        <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">minimum</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">step</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">minimum</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">step</span><span class="p">;</span>

        <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>

        <span class="n">dirs</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinf</span><span class="p">(</span><span class="mf">2.0f</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">10.f</span><span class="p">);</span>
        <span class="n">dirs</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinf</span><span class="p">(</span><span class="mf">2.0f</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="mf">10.f</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">generatePoints</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">points</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dirs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="n">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">NELEMS</span><span class="p">),</span> <span class="n">threads</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
                <span class="n">divup</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">NELEMS</span><span class="p">),</span> <span class="n">threads</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>

    <span class="n">pointGenKernel</span><span class="o">&lt;&lt;&lt;</span><span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span><span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">NELEMS</span><span class="p">),</span> <span class="n">MINIMUM</span><span class="p">,</span> <span class="n">STEP</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id6">
<h3>OpenCL<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cl_helpers.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">cl</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MINIMUM</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MAXIMUM</span> <span class="o">=</span> <span class="mf">20.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">STEP</span>    <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">NELEMS</span>  <span class="o">=</span> <span class="p">(</span><span class="n">MAXIMUM</span><span class="o">-</span><span class="n">MINIMUM</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">STEP</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DPOINTS</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">};</span>

<span class="cp">#define USE_FORGE_OPENCL_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">fieldKernel</span> <span class="o">=</span>
<span class="sa">R</span><span class="s">&quot;</span><span class="dl">EOK(</span><span class="s"></span>
<span class="s">constant float PI = 3.14159265359;</span>

<span class="s">kernel</span>
<span class="s">void pointGenKernel(global float* points, global float* dirs, int NELEMS, float MINIMUM, float STEP)</span>
<span class="s">{</span>
<span class="s">    int i = get_global_id(0);</span>
<span class="s">    int j = get_global_id(1);</span>

<span class="s">    if (i&lt;NELEMS &amp;&amp; j&lt;NELEMS) {</span>
<span class="s">        int id  = i + j * NELEMS;</span>

<span class="s">        float x = MINIMUM + i*STEP;</span>
<span class="s">        float y = MINIMUM + j*STEP;</span>

<span class="s">        points[2*id+0] = x;</span>
<span class="s">        points[2*id+1] = y;</span>

<span class="s">        dirs[2*id+0] = sin(2.0*PI*x/10.0);</span>
<span class="s">        dirs[2*id+1] = sin(2.0*PI*y/10.0);</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="dl">)EOK</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">generatePoints</span><span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">points</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">dirs</span><span class="p">,</span>
                    <span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="o">&amp;</span> <span class="n">queue</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Device</span> <span class="o">&amp;</span><span class="n">device</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span> <span class="n">prog</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>  <span class="n">pointGenKernel</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">compileFlag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_QUEUE_CONTEXT</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">fieldKernel</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cl</span><span class="o">::</span><span class="n">Device</span><span class="o">&gt;</span> <span class="n">devs</span><span class="p">;</span>
            <span class="n">devs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
            <span class="n">prog</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">devs</span><span class="p">);</span>

            <span class="n">pointGenKernel</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;pointGenKernel&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Compile Errors: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">prog</span><span class="p">.</span><span class="n">getBuildInfo</span><span class="o">&lt;</span><span class="n">CL_PROGRAM_BUILD_LOG</span><span class="o">&gt;</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&quot;Kernels compiled successfully&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">const</span> <span class="n">NDRange</span> <span class="n">local</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">NDRange</span> <span class="n">global</span><span class="p">(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">divup</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">NELEMS</span><span class="p">),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                   <span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">divup</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">NELEMS</span><span class="p">),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">])));</span>

    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">points</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dirs</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">NELEMS</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">MINIMUM</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">STEP</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">pointGenKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">         * First Forge call should be a window creation call</span>
<span class="cm">         * so that necessary OpenGL context is created for any</span>
<span class="cm">         * other forge::* object to be created successfully</span>
<span class="cm">         */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Vector Field Demo&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span> <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">);</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">);</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">divPoints</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u32</span><span class="p">,</span> <span class="n">FG_PLOT_SCATTER</span><span class="p">,</span> <span class="n">FG_MARKER_CIRCLE</span><span class="p">);</span>
        <span class="n">divPoints</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.9f</span><span class="p">,</span> <span class="mf">0.9f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>
        <span class="n">divPoints</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Convergence Points&quot;</span><span class="p">);</span>
        <span class="n">divPoints</span><span class="p">.</span><span class="n">setMarkerSize</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>

        <span class="kt">size_t</span> <span class="n">npoints</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)(</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">);</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">VectorField</span> <span class="n">field</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">vectorField</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">npoints</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
        <span class="n">field</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">0.6f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Helper function to create a CLGL interop context.</span>
<span class="cm">         * This function checks for if the extension is available</span>
<span class="cm">         * and creates the context on the appropriate device.</span>
<span class="cm">         * Note: context and queue are defined in cl_helpers.h</span>
<span class="cm">         */</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">createCLGLContext</span><span class="p">(</span><span class="n">wnd</span><span class="p">);</span>
        <span class="n">Device</span> <span class="n">device</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_CONTEXT_DEVICES</span><span class="o">&gt;</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">divPoints</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">directions</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">dpoints</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">points</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">npoints</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">dirs</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">npoints</span><span class="p">);</span>

        <span class="n">queue</span><span class="p">.</span><span class="n">enqueueWriteBuffer</span><span class="p">(</span><span class="n">dpoints</span><span class="p">,</span> <span class="n">CL_TRUE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="n">DPOINTS</span><span class="p">);</span>
        <span class="n">generatePoints</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dpoints</span><span class="p">(),</span> <span class="n">divPoints</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">points</span><span class="p">(),</span> <span class="n">field</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dirs</span><span class="p">(),</span> <span class="n">field</span><span class="p">.</span><span class="n">directionsSize</span><span class="p">());</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

        <span class="c1">// destroy GL-CUDA interop buffers</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">forge</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="histogram">
<h2>Histogram<a class="headerlink" href="#histogram" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>CPU<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CPU_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">IMGW</span>      <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">IMGH</span>      <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span>      <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span>      <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">NBINS</span>     <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Bitmap</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">height</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">PerlinNoise</span>
<span class="p">{</span>
    <span class="k">private</span><span class="o">:</span>
        <span class="kt">float</span> <span class="n">base</span><span class="p">[</span><span class="n">IMGW</span><span class="p">][</span><span class="n">IMGH</span><span class="p">];</span>
        <span class="kt">float</span> <span class="n">perlin</span><span class="p">[</span><span class="n">IMGW</span><span class="p">][</span><span class="n">IMGH</span><span class="p">];</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="n">PerlinNoise</span><span class="p">();</span>
        <span class="kt">float</span> <span class="nf">noise</span><span class="p">(</span><span class="kt">float</span> <span class="n">u</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">Bitmap</span> <span class="nf">createBitmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">w</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">h</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">destroyBitmap</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">populateBins</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">hist_array</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">nbins</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">hist_cols</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">Bitmap</span> <span class="n">bmp</span> <span class="o">=</span> <span class="n">createBitmap</span><span class="p">(</span><span class="n">IMGW</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">);</span>
    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Histogram Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Image</span> <span class="n">img</span><span class="p">(</span><span class="n">IMGW</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">,</span> <span class="n">FG_RGBA</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u8</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>

    <span class="cm">/* set x axis limits to maximum and minimum values of data</span>
<span class="cm">     * and y axis limits to range [0, number of pixels ideally]</span>
<span class="cm">     * but practically total number of pixels as y range will skew</span>
<span class="cm">     * the histogram graph vertically. Therefore setting it to</span>
<span class="cm">     * 25% of total number of pixels */</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">IMGW</span><span class="o">*</span><span class="n">IMGH</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">NBINS</span><span class="o">/</span><span class="mf">4.0</span><span class="p">));</span>

    <span class="cm">/*</span>
<span class="cm">     * Create histogram object specifying number of bins</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Histogram</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">NBINS</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">s32</span><span class="p">);</span>
    <span class="cm">/*</span>
<span class="cm">     * Set histogram colors</span>
<span class="cm">     */</span>
    <span class="n">hist</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="p">.</span><span class="n">pixels</span><span class="p">(),</span> <span class="n">FORGE_IMAGE_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hist</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="n">wnd</span><span class="p">.</span><span class="n">setColorMap</span><span class="p">((</span><span class="n">fg_color_map</span><span class="p">)(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">?</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">:</span> <span class="mi">1</span><span class="p">));</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">         * generate image, and prepare data to pass into</span>
<span class="cm">         * Histogram&#39;s underlying vertex buffer object</span>
<span class="cm">         */</span>
        <span class="n">kernel</span><span class="p">(</span><span class="n">bmp</span><span class="p">);</span>

        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

        <span class="c1">//forge::copy(img, (const void*)bmp.ptr);</span>

        <span class="cm">/* copy your data into the vertex buffer object exposed by</span>
<span class="cm">         * forge::Histogram class and then proceed to rendering.</span>
<span class="cm">         * To help the users with copying the data from compute</span>
<span class="cm">         * memory to display memory, Forge provides copy headers</span>
<span class="cm">         * along with the library to help with this task</span>
<span class="cm">         */</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">histArray</span><span class="p">(</span><span class="n">NBINS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">colArray</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">NBINS</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">populateBins</span><span class="p">(</span><span class="n">bmp</span><span class="p">,</span> <span class="n">histArray</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">NBINS</span><span class="p">,</span> <span class="n">colArray</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">histArray</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">hist</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">colArray</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">hist</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>

        <span class="cm">/*</span>
<span class="cm">         * Split the window into grid regions</span>
<span class="cm">         */</span>
        <span class="c1">//wnd.draw(2, 2, 0, img,  &quot;Dynamic Perlin Noise&quot; );</span>
        <span class="c1">//wnd.draw(2, 2, 1, img,  &quot;Dynamic Perlin Noise&quot; );</span>
        <span class="c1">//wnd.draw(2, 1, 1, chart, &quot;Histogram of Noisy Image&quot;);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span>  <span class="s">&quot;Dynamic Perlin Noise&quot;</span> <span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span>  <span class="s">&quot;Dynamic Perlin Noise&quot;</span> <span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span>  <span class="s">&quot;Dynamic Perlin Noise&quot;</span> <span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">chart</span><span class="p">,</span> <span class="s">&quot;Histogram of Noisy Image&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">chart</span><span class="p">,</span> <span class="s">&quot;Histogram of Noisy Image&quot;</span><span class="p">);</span>

        <span class="n">wnd</span><span class="p">.</span><span class="n">swapBuffers</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">interp</span><span class="p">(</span><span class="kt">float</span> <span class="n">x0</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">alpha</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">x0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">PerlinNoise</span><span class="o">::</span><span class="n">PerlinNoise</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">srand</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">std</span><span class="o">::</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IMGW</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">IMGH</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">base</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">RAND_MAX</span><span class="p">);</span>
            <span class="n">perlin</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">float</span> <span class="n">persistence</span> <span class="o">=</span> <span class="mf">0.5f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">amp</span>  <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">tamp</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">octave</span><span class="o">=</span><span class="mi">6</span><span class="p">;</span> <span class="n">octave</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">octave</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">octave</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">freq</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">period</span><span class="p">;</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IMGW</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">si0</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="n">period</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">si1</span> <span class="o">=</span> <span class="p">(</span><span class="n">si0</span> <span class="o">+</span> <span class="n">period</span><span class="p">)</span> <span class="o">%</span> <span class="n">IMGW</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">hblend</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">si0</span><span class="p">)</span> <span class="o">*</span> <span class="n">freq</span><span class="p">;</span>

            <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">IMGH</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">int</span> <span class="n">sj0</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">/</span><span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="n">period</span><span class="p">;</span>
                <span class="kt">int</span> <span class="n">sj1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sj0</span> <span class="o">+</span> <span class="n">period</span><span class="p">)</span> <span class="o">%</span> <span class="n">IMGH</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">vblend</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">sj0</span><span class="p">)</span> <span class="o">*</span> <span class="n">freq</span><span class="p">;</span>

                <span class="kt">float</span> <span class="n">top</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">base</span><span class="p">[</span><span class="n">si0</span><span class="p">][</span><span class="n">sj0</span><span class="p">],</span> <span class="n">base</span><span class="p">[</span><span class="n">si1</span><span class="p">][</span><span class="n">sj0</span><span class="p">],</span> <span class="n">hblend</span><span class="p">);</span>
                <span class="kt">float</span> <span class="n">bot</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">base</span><span class="p">[</span><span class="n">si0</span><span class="p">][</span><span class="n">sj1</span><span class="p">],</span> <span class="n">base</span><span class="p">[</span><span class="n">si1</span><span class="p">][</span><span class="n">sj1</span><span class="p">],</span> <span class="n">hblend</span><span class="p">);</span>

                <span class="n">perlin</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">amp</span> <span class="o">*</span> <span class="n">interp</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">vblend</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">tamp</span> <span class="o">+=</span> <span class="n">amp</span><span class="p">;</span>
        <span class="n">amp</span> <span class="o">*=</span> <span class="n">persistence</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IMGW</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">IMGH</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
            <span class="n">perlin</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">/=</span> <span class="n">tamp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="n">PerlinNoise</span><span class="o">::</span><span class="n">noise</span><span class="p">(</span><span class="kt">float</span> <span class="n">u</span><span class="p">,</span> <span class="kt">float</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">perlin</span><span class="p">[(</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">IMGW</span><span class="o">*</span><span class="n">u</span><span class="p">)][(</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">IMGH</span><span class="o">*</span><span class="n">v</span><span class="p">)];</span>
<span class="p">}</span>

<span class="n">Bitmap</span> <span class="n">createBitmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">w</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Bitmap</span> <span class="n">retVal</span><span class="p">;</span>
    <span class="n">retVal</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
    <span class="n">retVal</span><span class="p">.</span><span class="n">height</span><span class="o">=</span> <span class="n">h</span><span class="p">;</span>
    <span class="n">retVal</span><span class="p">.</span><span class="n">ptr</span>   <span class="o">=</span> <span class="k">new</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">retVal</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">destroyBitmap</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">delete</span><span class="p">[]</span> <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">kernel</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PerlinNoise</span> <span class="n">perlin</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">bmp</span><span class="p">.</span><span class="n">height</span><span class="p">;</span> <span class="o">++</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">offset</span>  <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>

            <span class="kt">float</span> <span class="n">u</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">);</span>
            <span class="kt">float</span> <span class="n">v</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">bmp</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>

            <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">noiseVal</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">perlin</span><span class="p">.</span><span class="n">noise</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">));</span>
            <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">noiseVal</span><span class="p">;</span>
            <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="n">noiseVal</span><span class="p">;</span>
            <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>  <span class="o">=</span> <span class="n">noiseVal</span><span class="p">;</span>
            <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">populateBins</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">hist_array</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">nbins</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">hist_cols</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">bmp</span><span class="p">.</span><span class="n">height</span><span class="p">;</span> <span class="o">++</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">offset</span>  <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
            <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">noiseVal</span> <span class="o">=</span> <span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span><span class="p">];</span>
            <span class="kt">unsigned</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="kt">float</span><span class="p">)</span><span class="n">noiseVal</span><span class="o">/</span><span class="mf">255.f</span> <span class="o">*</span> <span class="n">nbins</span><span class="p">);</span>
            <span class="n">hist_array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">b</span><span class="o">&lt;</span><span class="n">nbins</span><span class="p">;</span> <span class="o">++</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hist_cols</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">RAND_MAX</span><span class="p">;</span>
        <span class="n">hist_cols</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">RAND_MAX</span><span class="p">;</span>
        <span class="n">hist_cols</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">RAND_MAX</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id8">
<h3>CUDA<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuda_runtime.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;curand.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;curand_kernel.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuComplex.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CUDA_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">IMGW</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">IMGH</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">NBINS</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>

<span class="n">curandState_t</span><span class="o">*</span> <span class="n">state</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Bitmap</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">height</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">PerlinNoise</span>
<span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="kt">float</span><span class="o">*</span> <span class="n">base</span><span class="p">;</span>
        <span class="kt">float</span><span class="o">*</span> <span class="n">perlin</span><span class="p">;</span>

        <span class="n">PerlinNoise</span><span class="p">();</span>
        <span class="o">~</span><span class="n">PerlinNoise</span><span class="p">();</span>
        <span class="kt">void</span> <span class="nf">generateNoise</span><span class="p">();</span>
<span class="p">};</span>

<span class="n">Bitmap</span> <span class="nf">createBitmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">w</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">h</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">destroyBitmap</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">,</span> <span class="n">PerlinNoise</span><span class="o">&amp;</span> <span class="n">pn</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">populateBins</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">hist_array</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">nbins</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">hist_cols</span><span class="p">);</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">setupRandomKernel</span><span class="p">(</span><span class="n">curandState</span> <span class="o">*</span><span class="n">states</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">seed</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">curand_init</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">tid</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Bitmap</span> <span class="n">bmp</span> <span class="o">=</span> <span class="n">createBitmap</span><span class="p">(</span><span class="n">IMGW</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">);</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span> <span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">state</span><span class="p">,</span> <span class="n">NBINS</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">curandState_t</span><span class="p">)));</span>
    <span class="n">setupRandomKernel</span> <span class="o">&lt;&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NBINS</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">314567</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Histogram Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Image</span> <span class="n">img</span><span class="p">(</span><span class="n">IMGW</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">,</span> <span class="n">FG_RGBA</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u8</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>

    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLabelFormat</span><span class="p">(</span><span class="s">&quot;%3.1f&quot;</span><span class="p">,</span> <span class="s">&quot;%.2e&quot;</span><span class="p">);</span>

    <span class="cm">/* set x axis limits to maximum and minimum values of data</span>
<span class="cm">     * and y axis limits to range [0, number of pixels ideally]</span>
<span class="cm">     * but practically total number of pixels as y range will skew</span>
<span class="cm">     * the histogram graph vertically. Therefore setting it to</span>
<span class="cm">     * 25% of total number of pixels */</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">IMGW</span><span class="o">*</span><span class="n">IMGH</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">NBINS</span><span class="o">/</span><span class="mf">4.0</span><span class="p">));</span>

    <span class="cm">/*</span>
<span class="cm">     * Create histogram object specifying number of bins</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Histogram</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">NBINS</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">s32</span><span class="p">);</span>
    <span class="cm">/*</span>
<span class="cm">     * Set histogram colors</span>
<span class="cm">     */</span>
    <span class="n">hist</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>

    <span class="n">PerlinNoise</span> <span class="n">noiseGenerator</span><span class="p">;</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">histOut</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">histColors</span><span class="p">;</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">histOut</span><span class="p">,</span> <span class="n">NBINS</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">histColors</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">NBINS</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="p">.</span><span class="n">pixels</span><span class="p">(),</span> <span class="n">FORGE_IMAGE_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hist</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="kt">unsigned</span> <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">frame</span><span class="o">%</span><span class="mi">8</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">kernel</span><span class="p">(</span><span class="n">bmp</span><span class="p">,</span> <span class="n">noiseGenerator</span><span class="p">);</span>
            <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

            <span class="n">populateBins</span><span class="p">(</span><span class="n">bmp</span><span class="p">,</span> <span class="n">histOut</span><span class="p">,</span> <span class="n">NBINS</span><span class="p">,</span> <span class="n">histColors</span><span class="p">);</span>

            <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">histOut</span><span class="p">,</span> <span class="n">hist</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
            <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">histColors</span><span class="p">,</span> <span class="n">hist</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>

            <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/*</span>
<span class="cm">         * Split the window into grid regions</span>
<span class="cm">         */</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span>  <span class="s">&quot;Dynamic Perlin Noise&quot;</span> <span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">chart</span><span class="p">,</span> <span class="s">&quot;Histogram of Noisy Image&quot;</span><span class="p">);</span>

        <span class="n">wnd</span><span class="p">.</span><span class="n">swapBuffers</span><span class="p">();</span>
        <span class="n">frame</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">histOut</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">histColors</span><span class="p">));</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Bitmap</span> <span class="nf">createBitmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">w</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Bitmap</span> <span class="n">retVal</span><span class="p">;</span>
    <span class="n">retVal</span><span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
    <span class="n">retVal</span><span class="p">.</span><span class="n">height</span><span class="o">=</span> <span class="n">h</span><span class="p">;</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">retVal</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">h</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">retVal</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">destroyBitmap</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">PerlinNoise</span><span class="o">::</span><span class="n">PerlinNoise</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">size_t</span> <span class="n">IMG_SIZE</span> <span class="o">=</span> <span class="n">IMGW</span><span class="o">*</span><span class="n">IMGH</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">);</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">base</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">perlin</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">PerlinNoise</span><span class="o">::~</span><span class="n">PerlinNoise</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">perlin</span><span class="p">));</span>
<span class="p">}</span>

<span class="kr">inline</span>
<span class="kt">int</span> <span class="n">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__device__</span>
<span class="kt">float</span> <span class="n">interp</span><span class="p">(</span><span class="kt">float</span> <span class="n">x0</span><span class="p">,</span> <span class="kt">float</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">alpha</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">x0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">x1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="n">perlinInitKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">perlin</span><span class="p">,</span> <span class="n">curandState</span><span class="o">*</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">IMGW</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">IMGH</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">IMGW</span> <span class="o">+</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">base</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">curand_uniform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">[</span><span class="n">index</span><span class="o">%</span><span class="n">NBINS</span><span class="p">]);</span>
        <span class="n">perlin</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="n">perlinComputeKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">perlin</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">amp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">period</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="n">x</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">y</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">IMGW</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">IMGH</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">index</span>  <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">IMGW</span> <span class="o">+</span> <span class="n">x</span><span class="p">;</span>

        <span class="kt">float</span> <span class="n">freq</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">period</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">si0</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="n">period</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">si1</span> <span class="o">=</span> <span class="p">(</span><span class="n">si0</span> <span class="o">+</span> <span class="n">period</span><span class="p">)</span> <span class="o">%</span> <span class="n">IMGW</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">hblend</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">si0</span><span class="p">)</span> <span class="o">*</span> <span class="n">freq</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">sj0</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">period</span><span class="p">)</span> <span class="o">*</span> <span class="n">period</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">sj1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sj0</span> <span class="o">+</span> <span class="n">period</span><span class="p">)</span> <span class="o">%</span> <span class="n">IMGH</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">vblend</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">sj0</span><span class="p">)</span> <span class="o">*</span> <span class="n">freq</span><span class="p">;</span>

        <span class="kt">float</span> <span class="n">top</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">base</span><span class="p">[</span><span class="n">si0</span><span class="o">+</span><span class="n">IMGW</span><span class="o">*</span><span class="n">sj0</span><span class="p">],</span> <span class="n">base</span><span class="p">[</span><span class="n">si1</span><span class="o">+</span><span class="n">IMGW</span><span class="o">*</span><span class="n">sj0</span><span class="p">],</span> <span class="n">hblend</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">bot</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">base</span><span class="p">[</span><span class="n">si0</span><span class="o">+</span><span class="n">IMGW</span><span class="o">*</span><span class="n">sj1</span><span class="p">],</span> <span class="n">base</span><span class="p">[</span><span class="n">si1</span><span class="o">+</span><span class="n">IMGW</span><span class="o">*</span><span class="n">sj1</span><span class="p">],</span> <span class="n">hblend</span><span class="p">);</span>

        <span class="n">perlin</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">amp</span> <span class="o">*</span> <span class="n">interp</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">vblend</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="n">perlinNormalize</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">perlin</span><span class="p">,</span> <span class="kt">float</span> <span class="n">tamp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">IMGW</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">IMGH</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">IMGW</span> <span class="o">+</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">perlin</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">perlin</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">/</span><span class="n">tamp</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">PerlinNoise</span><span class="o">::</span><span class="n">generateNoise</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="nf">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">IMGW</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">divup</span><span class="p">(</span><span class="n">IMGH</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>

    <span class="kt">float</span> <span class="n">persistence</span> <span class="o">=</span> <span class="mf">0.5f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">amp</span>  <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">tamp</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="n">perlinInitKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">perlin</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">octave</span><span class="o">=</span><span class="mi">6</span><span class="p">;</span> <span class="n">octave</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">octave</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">octave</span><span class="p">;</span>

        <span class="n">perlinComputeKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">perlin</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">amp</span><span class="p">,</span> <span class="n">period</span><span class="p">);</span>

        <span class="n">tamp</span> <span class="o">+=</span> <span class="n">amp</span><span class="p">;</span>
        <span class="n">amp</span> <span class="o">*=</span> <span class="n">persistence</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">perlinNormalize</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">perlin</span><span class="p">,</span> <span class="n">tamp</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="n">fillImageKernel</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ptr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">width</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">height</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">perlin</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">width</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">offset</span>  <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">width</span><span class="p">;</span>

        <span class="kt">unsigned</span> <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">IMGW</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">width</span><span class="p">));</span>
        <span class="kt">unsigned</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">IMGH</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">height</span><span class="p">));</span>
        <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">IMGW</span><span class="p">;</span>

        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">perlin</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
        <span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
        <span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
        <span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
        <span class="n">ptr</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">kernel</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">,</span> <span class="n">PerlinNoise</span><span class="o">&amp;</span> <span class="n">pn</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

    <span class="n">pn</span><span class="p">.</span><span class="n">generateNoise</span><span class="p">();</span>

    <span class="n">dim3</span> <span class="nf">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">divup</span><span class="p">(</span><span class="n">bmp</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>

    <span class="n">fillImageKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">bmp</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">pn</span><span class="p">.</span><span class="n">perlin</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="n">histogramKernel</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">perlinNoise</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">histOut</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">nbins</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">IMGW</span> <span class="o">&amp;&amp;</span> <span class="n">y</span><span class="o">&lt;</span><span class="n">IMGH</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">offset</span>  <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">IMGW</span> <span class="o">+</span> <span class="n">x</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">noiseVal</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">[</span><span class="n">offset</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">0</span><span class="p">];</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">__float2int_rd</span><span class="p">(</span><span class="n">nbins</span> <span class="o">*</span> <span class="p">(</span><span class="n">__int2float_rd</span><span class="p">(</span><span class="n">noiseVal</span><span class="p">)</span><span class="o">/</span><span class="mf">255.f</span><span class="p">));</span>
        <span class="n">atomicAdd</span><span class="p">(</span><span class="n">histOut</span> <span class="o">+</span> <span class="n">offset</span> <span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="n">histColorsKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">histColors</span><span class="p">,</span> <span class="n">curandState</span> <span class="o">*</span><span class="n">states</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">bin</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

    <span class="n">histColors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">bin</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">curand_uniform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">bin</span><span class="p">]);</span>
    <span class="n">histColors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">bin</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curand_uniform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">bin</span><span class="p">]);</span>
    <span class="n">histColors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">bin</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">curand_uniform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">states</span><span class="p">[</span><span class="n">bin</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">populateBins</span><span class="p">(</span><span class="n">Bitmap</span><span class="o">&amp;</span> <span class="n">bmp</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">histOut</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">nbins</span><span class="p">,</span> <span class="kt">float</span> <span class="o">*</span><span class="n">histColors</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="nf">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">bmp</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
                <span class="n">divup</span><span class="p">(</span><span class="n">bmp</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>

    <span class="n">cudaMemset</span><span class="p">(</span><span class="n">histOut</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>

    <span class="n">histogramKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">bmp</span><span class="p">.</span><span class="n">ptr</span><span class="p">,</span> <span class="n">histOut</span><span class="p">,</span> <span class="n">nbins</span><span class="p">);</span>

    <span class="n">histColorsKernel</span><span class="o">&lt;&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbins</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">histColors</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id9">
<h3>OpenCL<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cl_helpers.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">cl</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">IMGW</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">IMGH</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">IMG_SIZE</span> <span class="o">=</span> <span class="n">IMGW</span> <span class="o">*</span> <span class="n">IMGH</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">NBINS</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">PERSISTENCE</span> <span class="o">=</span> <span class="mf">0.5f</span><span class="p">;</span>

<span class="cp">#define USE_FORGE_OPENCL_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">perlinKernels</span> <span class="o">=</span>
<span class="sa">R</span><span class="s">&quot;</span><span class="dl">EOK(</span><span class="s"></span>
<span class="s">float rand(int x)</span>
<span class="s">{</span>
<span class="s">    x = (x &lt;&lt; 13) ^ x;</span>
<span class="s">    return ( 1.0 - ( (x * (x * x * 15731 + 789221) + 1376312589) &amp; 0x7fffffff) / 1073741824.0);</span>
<span class="s">}</span>

<span class="s">float interp(float x0, float x1, float t)</span>
<span class="s">{</span>
<span class="s">    return x0 + (x1 - x0) * t;</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void init(global float* base, global float* perlin, int IMGW, int IMGH, int randSeed)</span>
<span class="s">{</span>
<span class="s">    int x = get_global_id(0);</span>
<span class="s">    int y = get_global_id(1);</span>

<span class="s">    if (x&lt;IMGW &amp;&amp; y&lt;IMGH) {</span>
<span class="s">        int i = x + y * IMGW;</span>
<span class="s">        base[i] = (1+rand(randSeed * i))/2.0f;</span>
<span class="s">        perlin[i] = 0.0f;</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void compute(global float* perlin, global float* base,</span>
<span class="s">             unsigned IMGW, unsigned IMGH, float amp, int period)</span>
<span class="s">{</span>
<span class="s">    int x = get_global_id(0);</span>
<span class="s">    int y = get_global_id(1);</span>

<span class="s">    if (x&lt;IMGW &amp;&amp; y&lt;IMGH) {</span>
<span class="s">        int index  = y*IMGW + x;</span>

<span class="s">        float freq = 1.0f / period;</span>

<span class="s">        int si0 = (x/period) * period;</span>
<span class="s">        int si1 = (si0 + period) % IMGW;</span>
<span class="s">        float hblend = (x - si0) * freq;</span>

<span class="s">        int sj0 = (y/period) * period;</span>
<span class="s">        int sj1 = (sj0 + period) % IMGH;</span>
<span class="s">        float vblend = (y - sj0) * freq;</span>

<span class="s">        float top = interp(base[si0+IMGW*sj0], base[si1+IMGW*sj0], hblend);</span>
<span class="s">        float bot = interp(base[si0+IMGW*sj1], base[si1+IMGW*sj1], hblend);</span>

<span class="s">        perlin[index] += (amp * interp(top, bot, vblend));</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void normalizeNoise(global float* perlin, unsigned IMGW, unsigned IMGH, float tamp)</span>
<span class="s">{</span>
<span class="s">    int x = get_global_id(0);</span>
<span class="s">    int y = get_global_id(1);</span>

<span class="s">    if (x&lt;IMGW &amp;&amp; y&lt;IMGH) {</span>
<span class="s">        int index = y*IMGW + x;</span>
<span class="s">        perlin[index] = perlin[index]/tamp;</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void fillImage(global unsigned char* ptr, unsigned width, unsigned height,</span>
<span class="s">               global float* perlin, unsigned IMGW, unsigned IMGH)</span>
<span class="s">{</span>
<span class="s">    int x = get_global_id(0);</span>
<span class="s">    int y = get_global_id(1);</span>

<span class="s">    if (x&lt;width &amp;&amp; y&lt;height) {</span>
<span class="s">        int offset  = x + y * width;</span>

<span class="s">        unsigned u = (unsigned)(IMGW*x/(float)(width));</span>
<span class="s">        unsigned v = (unsigned)(IMGH*y/(float)(height));</span>
<span class="s">        int idx = u + v*IMGW;</span>

<span class="s">        unsigned char val = 255 * perlin[idx];</span>
<span class="s">        ptr[offset*4 + 0] = val;</span>
<span class="s">        ptr[offset*4 + 1] = val;</span>
<span class="s">        ptr[offset*4 + 2] = val;</span>
<span class="s">        ptr[offset*4 + 3] = 255;</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void memSet(global int* out, unsigned len)</span>
<span class="s">{</span>
<span class="s">    if (get_global_id(0)&lt;len)</span>
<span class="s">        out[get_global_id(0)] = 0;</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void histogram(const global unsigned char* perlinNoise, global int* histOut,</span>
<span class="s">               const unsigned w, const unsigned h, const unsigned nbins)</span>
<span class="s">{</span>
<span class="s">    int x = get_global_id(0);</span>
<span class="s">    int y = get_global_id(1);</span>

<span class="s">    if (x&lt;w &amp;&amp; y&lt;h) {</span>
<span class="s">        int offset  = y * w + x;</span>
<span class="s">        unsigned char noiseVal = perlinNoise[offset*4 + 0];</span>
<span class="s">        offset = (int)(nbins * (noiseVal/255.f));</span>
<span class="s">        atomic_add(histOut + offset , 1);</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void setColors(global float* out, unsigned rseed, unsigned gseed, unsigned bseed)</span>
<span class="s">{</span>
<span class="s">    int i = get_global_id(0);</span>
<span class="s">    out[3*i+0] = (1+rand(rseed * i))/2.0f;</span>
<span class="s">    out[3*i+1] = (1+rand(gseed * i))/2.0f;</span>
<span class="s">    out[3*i+2] = (1+rand(bseed * i))/2.0f;</span>
<span class="s">};</span>
<span class="dl">)EOK</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">base</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">perlin</span><span class="p">,</span>
            <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">histOut</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">colors</span><span class="p">,</span>
            <span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="o">&amp;</span> <span class="n">queue</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Device</span><span class="o">&amp;</span> <span class="n">device</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span> <span class="n">prog</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>  <span class="n">initKernel</span><span class="p">,</span> <span class="n">computeKernel</span><span class="p">,</span> <span class="n">normKernel</span><span class="p">,</span> <span class="n">fillKernel</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>  <span class="n">memSetKernel</span><span class="p">,</span> <span class="n">genHistogram</span><span class="p">,</span> <span class="n">genHistColors</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">srand</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">std</span><span class="o">::</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">compileFlag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_QUEUE_CONTEXT</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">perlinKernels</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cl</span><span class="o">::</span><span class="n">Device</span><span class="o">&gt;</span> <span class="n">devs</span><span class="p">;</span>
            <span class="n">devs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
            <span class="n">prog</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">devs</span><span class="p">);</span>

            <span class="n">initKernel</span>    <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;init&quot;</span><span class="p">);</span>
            <span class="n">computeKernel</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;compute&quot;</span><span class="p">);</span>
            <span class="n">normKernel</span>    <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;normalizeNoise&quot;</span><span class="p">);</span>
            <span class="n">fillKernel</span>    <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;fillImage&quot;</span><span class="p">);</span>
            <span class="n">memSetKernel</span>  <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;memSet&quot;</span><span class="p">);</span>
            <span class="n">genHistogram</span>  <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;histogram&quot;</span><span class="p">);</span>
            <span class="n">genHistColors</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;setColors&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Compile Errors: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">prog</span><span class="p">.</span><span class="n">getBuildInfo</span><span class="o">&lt;</span><span class="n">CL_PROGRAM_BUILD_LOG</span><span class="o">&gt;</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&quot;Kernels compiled successfully&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">const</span> <span class="n">NDRange</span> <span class="n">local</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
    <span class="n">NDRange</span> <span class="n">global</span><span class="p">(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">divup</span><span class="p">(</span><span class="n">IMGW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                   <span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">divup</span><span class="p">(</span><span class="n">IMGH</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">])));</span>

    <span class="kt">float</span> <span class="n">persistence</span> <span class="o">=</span> <span class="mf">0.5f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">amp</span>  <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">tamp</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

    <span class="n">initKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">base</span><span class="p">);</span>
    <span class="n">initKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">perlin</span><span class="p">);</span>
    <span class="n">initKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">IMGW</span><span class="p">);</span>
    <span class="n">initKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">);</span>
    <span class="n">initKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">initKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">octave</span><span class="o">=</span><span class="mi">6</span><span class="p">;</span> <span class="n">octave</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">octave</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">octave</span><span class="p">;</span>
        <span class="n">computeKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">perlin</span><span class="p">);</span>
        <span class="n">computeKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">base</span><span class="p">);</span>
        <span class="n">computeKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">IMGW</span><span class="p">);</span>
        <span class="n">computeKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">);</span>
        <span class="n">computeKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">amp</span><span class="p">);</span>
        <span class="n">computeKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">period</span><span class="p">);</span>
        <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">computeKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>
        <span class="n">tamp</span> <span class="o">+=</span> <span class="n">amp</span><span class="p">;</span>
        <span class="n">amp</span> <span class="o">*=</span> <span class="n">persistence</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">normKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">perlin</span><span class="p">);</span>
    <span class="n">normKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">IMGW</span><span class="p">);</span>
    <span class="n">normKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">);</span>
    <span class="n">normKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">tamp</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">normKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>

    <span class="n">fillKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
    <span class="n">fillKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">IMGW</span><span class="p">);</span>
    <span class="n">fillKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">);</span>
    <span class="n">fillKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">perlin</span><span class="p">);</span>
    <span class="n">fillKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">IMGW</span><span class="p">);</span>
    <span class="n">fillKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">fillKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>

    <span class="k">static</span> <span class="k">const</span> <span class="n">NDRange</span> <span class="n">global_hist</span><span class="p">(</span><span class="n">NBINS</span><span class="p">);</span>

    <span class="n">memSetKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">histOut</span><span class="p">);</span>
    <span class="n">memSetKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">NBINS</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">memSetKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global_hist</span><span class="p">);</span>

    <span class="n">genHistogram</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
    <span class="n">genHistogram</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">histOut</span><span class="p">);</span>
    <span class="n">genHistogram</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">IMGW</span><span class="p">);</span>
    <span class="n">genHistogram</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">);</span>
    <span class="n">genHistogram</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">NBINS</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">genHistogram</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>

    <span class="n">genHistColors</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">colors</span><span class="p">);</span>
    <span class="n">genHistColors</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
    <span class="n">genHistColors</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
    <span class="n">genHistColors</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">());</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">genHistColors</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global_hist</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>

        <span class="cm">/*</span>
<span class="cm">        * First Forge call should be a window creation call</span>
<span class="cm">        * so that necessary OpenGL context is created for any</span>
<span class="cm">        * other forge::* object to be created successfully</span>
<span class="cm">        */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Histogram Demo&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Image</span> <span class="n">img</span><span class="p">(</span><span class="n">IMGW</span><span class="p">,</span> <span class="n">IMGH</span><span class="p">,</span> <span class="n">FG_RGBA</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">u8</span><span class="p">);</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>

        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLabelFormat</span><span class="p">(</span><span class="s">&quot;%3.1f&quot;</span><span class="p">,</span> <span class="s">&quot;%.2e&quot;</span><span class="p">);</span>

        <span class="cm">/* set x axis limits to maximum and minimum values of data</span>
<span class="cm">         * and y axis limits to range [0, number of pixels ideally]</span>
<span class="cm">         * but practically total number of pixels as y range will skew</span>
<span class="cm">         * the histogram graph vertically. Therefore setting it to</span>
<span class="cm">         * 25% of total number of pixels */</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">IMGW</span><span class="o">*</span><span class="n">IMGH</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">NBINS</span><span class="o">/</span><span class="mf">4.0</span><span class="p">));</span>

        <span class="cm">/*</span>
<span class="cm">         * Create histogram object specifying number of bins</span>
<span class="cm">         */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Histogram</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">NBINS</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">s32</span><span class="p">);</span>
        <span class="cm">/*</span>
<span class="cm">         * Set histogram colors</span>
<span class="cm">         */</span>
        <span class="n">hist</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Helper function to create a CLGL interop context.</span>
<span class="cm">         * This function checks for if the extension is available</span>
<span class="cm">         * and creates the context on the appropriate device.</span>
<span class="cm">         * Note: context and queue are defined in cl_helpers.h</span>
<span class="cm">         */</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">createCLGLContext</span><span class="p">(</span><span class="n">wnd</span><span class="p">);</span>
        <span class="n">Device</span> <span class="n">device</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_CONTEXT_DEVICES</span><span class="o">&gt;</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">image</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">baseNoise</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="n">IMG_SIZE</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">histOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="n">NBINS</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">colors</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">NBINS</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">));</span>

        <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="p">.</span><span class="n">pixels</span><span class="p">(),</span> <span class="n">FORGE_IMAGE_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hist</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

        <span class="kt">unsigned</span> <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">frame</span><span class="o">%</span><span class="mi">8</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">kernel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">baseNoise</span><span class="p">,</span> <span class="n">perlinNoise</span><span class="p">,</span> <span class="n">histOut</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

                <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">image</span><span class="p">(),</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
                <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">histOut</span><span class="p">(),</span> <span class="n">hist</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
                <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">colors</span><span class="p">(),</span> <span class="n">hist</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>

                <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="cm">/*</span>
<span class="cm">             * Split the window into grid regions</span>
<span class="cm">             */</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span>  <span class="s">&quot;Dynamic Perlin Noise&quot;</span> <span class="p">);</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">chart</span><span class="p">,</span> <span class="s">&quot;Histogram of Noisy Image&quot;</span><span class="p">);</span>

            <span class="n">wnd</span><span class="p">.</span><span class="n">swapBuffers</span><span class="p">();</span>
            <span class="n">frame</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">forge</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="d-line-plot">
<h2>3D Line Plot<a class="headerlink" href="#d-line-plot" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>CPU<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CPU_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">ZMIN</span> <span class="o">=</span> <span class="mf">0.1f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">ZMAX</span> <span class="o">=</span> <span class="mf">10.f</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">DX</span> <span class="o">=</span> <span class="mf">0.005f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">ZSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)((</span><span class="n">ZMAX</span><span class="o">-</span><span class="n">ZMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">generateCurve</span><span class="p">(</span><span class="kt">float</span> <span class="n">t</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dx</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">vec</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">vec</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ZSIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">ZMIN</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">dx</span><span class="p">;</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="n">cos</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">t</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">z</span><span class="p">));</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="n">sin</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">t</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">z</span><span class="p">));</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="n">z</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Three dimensional line plot demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>

    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLabelFormat</span><span class="p">(</span><span class="s">&quot;%3.1f&quot;</span><span class="p">,</span> <span class="s">&quot;%3.1f&quot;</span><span class="p">,</span> <span class="s">&quot;%.2e&quot;</span><span class="p">);</span>

    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1f</span><span class="p">,</span> <span class="mf">1.1f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1f</span><span class="p">,</span> <span class="mf">1.1f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">10.f</span><span class="p">);</span>

    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plot3</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ZSIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>

    <span class="c1">//generate a surface</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">function</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">float</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">generateCurve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">function</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span><span class="p">;</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">plot3</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="cm">/* copy your data into the pixel buffer object exposed by</span>
<span class="cm">     * forge::Plot class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">function</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plot3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">t</span><span class="o">+=</span><span class="mf">0.01f</span><span class="p">;</span>
        <span class="n">generateCurve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">function</span><span class="p">);</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">function</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plot3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id11">
<h3>CUDA<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuda_runtime.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuComplex.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CUDA_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">ZMIN</span> <span class="o">=</span> <span class="mf">0.1f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">ZMAX</span> <span class="o">=</span> <span class="mf">10.f</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">DX</span> <span class="o">=</span> <span class="mf">0.005f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">ZSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)((</span><span class="n">ZMAX</span><span class="o">-</span><span class="n">ZMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">float</span> <span class="n">t</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dx</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">dev_out</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Three dimensional line plot demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>

    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLabelFormat</span><span class="p">(</span><span class="s">&quot;%3.1f&quot;</span><span class="p">,</span> <span class="s">&quot;%3.1f&quot;</span><span class="p">,</span> <span class="s">&quot;%.2e&quot;</span><span class="p">);</span>

    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1f</span><span class="p">,</span> <span class="mf">1.1f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1f</span><span class="p">,</span> <span class="mf">1.1f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">10.f</span><span class="p">);</span>

    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plot3</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ZSIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>

    <span class="k">static</span> <span class="kt">float</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">ZSIZE</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="p">));</span>
    <span class="n">kernel</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">dev_out</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span><span class="p">;</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">plot3</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="cm">/* copy your data into the vertex buffer object exposed by</span>
<span class="cm">     * forge::Plot class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">plot3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">t</span><span class="o">+=</span><span class="mf">0.01f</span><span class="p">;</span>
        <span class="n">kernel</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">DX</span><span class="p">,</span> <span class="n">dev_out</span><span class="p">);</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">plot3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">dev_out</span><span class="p">));</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">generateCurve</span><span class="p">(</span><span class="kt">float</span> <span class="n">t</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dx</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">ZMIN</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">ZSIZE</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">ZMIN</span> <span class="o">+</span> <span class="n">offset</span><span class="o">*</span><span class="n">dx</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="n">ZSIZE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">out</span><span class="p">[</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">offset</span>     <span class="p">]</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">t</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">z</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">t</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">z</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">float</span> <span class="n">t</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dx</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="n">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">ZSIZE</span><span class="p">,</span> <span class="mi">1024</span><span class="p">));</span>

    <span class="n">generateCurve</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dev_out</span><span class="p">,</span> <span class="n">ZMIN</span><span class="p">,</span> <span class="n">ZSIZE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id12">
<h3>OpenCL<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cl_helpers.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;mutex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">ZMIN</span> <span class="o">=</span> <span class="mf">0.1f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">ZMAX</span> <span class="o">=</span> <span class="mf">10.f</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">DX</span> <span class="o">=</span> <span class="mf">0.005f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">ZSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)((</span><span class="n">ZMAX</span><span class="o">-</span><span class="n">ZMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="cp">#define USE_FORGE_OPENCL_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sincos_surf_kernel</span> <span class="o">=</span>
<span class="s">&quot;kernel void generateCurve(global float* out, const float t, const float dx, const float zmin, const unsigned SIZE)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;{</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    int offset = get_global_id(0);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    float z = zmin + offset*dx;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    if (offset &lt; SIZE) {</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;       out[offset*3 + 0] = cos(z*t+t)/z;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;       out[offset*3 + 1] = sin(z*t+t)/z;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;       out[offset*3 + 2] = z + 0.1*sin(t);</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;    }</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">devOut</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="o">&amp;</span> <span class="n">queue</span><span class="p">,</span> <span class="kt">float</span> <span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">once_flag</span>   <span class="n">compileFlag</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span>      <span class="n">prog</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>       <span class="n">kern</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">call_once</span><span class="p">(</span><span class="n">compileFlag</span><span class="p">,</span>
        <span class="p">[</span><span class="n">queue</span><span class="p">]()</span> <span class="p">{</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_QUEUE_CONTEXT</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">sincos_surf_kernel</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
            <span class="n">kern</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;generateCurve&quot;</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="n">NDRange</span> <span class="n">global</span><span class="p">(</span><span class="n">ZSIZE</span><span class="p">);</span>

    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devOut</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">DX</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">ZMIN</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">ZSIZE</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>

        <span class="cm">/*</span>
<span class="cm">         * First Forge call should be a window creation call</span>
<span class="cm">         * so that necessary OpenGL context is created for any</span>
<span class="cm">         * other forge::* object to be created successfully</span>
<span class="cm">         */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Three dimensional line plot demo&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>

        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLabelFormat</span><span class="p">(</span><span class="s">&quot;%3.1f&quot;</span><span class="p">,</span> <span class="s">&quot;%3.1f&quot;</span><span class="p">,</span> <span class="s">&quot;%.2e&quot;</span><span class="p">);</span>

        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1f</span><span class="p">,</span> <span class="mf">1.1f</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1f</span><span class="p">,</span> <span class="mf">1.1f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">10.f</span><span class="p">);</span>

        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plot3</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ZSIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Helper function to create a CLGL interop context.</span>
<span class="cm">         * This function checks for if the extension is available</span>
<span class="cm">         * and creates the context on the appropriate device.</span>
<span class="cm">         * Note: context and queue are defined in cl_helpers.h</span>
<span class="cm">         */</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">createCLGLContext</span><span class="p">(</span><span class="n">wnd</span><span class="p">);</span>
        <span class="n">Device</span> <span class="n">device</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_CONTEXT_DEVICES</span><span class="o">&gt;</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">devOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">ZSIZE</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
        <span class="k">static</span> <span class="kt">float</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">kernel</span><span class="p">(</span><span class="n">devOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>

        <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span><span class="p">;</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">plot3</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="cm">/* copy your data into the pixel buffer object exposed by</span>
<span class="cm">         * forge::Surface class and then proceed to rendering.</span>
<span class="cm">         * To help the users with copying the data from compute</span>
<span class="cm">         * memory to display memory, Forge provides copy headers</span>
<span class="cm">         * along with the library to help with this task</span>
<span class="cm">         */</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">devOut</span><span class="p">(),</span> <span class="n">plot3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">t</span><span class="o">+=</span><span class="mf">0.01f</span><span class="p">;</span>
            <span class="n">kernel</span><span class="p">(</span><span class="n">devOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
            <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">devOut</span><span class="p">(),</span> <span class="n">plot3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">forge</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="multiple-line-plots">
<h2>Multiple line plots<a class="headerlink" href="#multiple-line-plots" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id13">
<h3>CPU<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CPU_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">FRANGE_START</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">FRANGE_END</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="mf">3.1415926f</span><span class="p">;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">map_range_to_vec_vbo</span><span class="p">(</span><span class="kt">float</span> <span class="n">range_start</span><span class="p">,</span> <span class="kt">float</span> <span class="n">range_end</span><span class="p">,</span> <span class="kt">float</span> <span class="n">dx</span><span class="p">,</span>
                          <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">vec</span><span class="p">,</span>
                          <span class="kt">float</span> <span class="p">(</span><span class="o">*</span><span class="n">map</span><span class="p">)</span> <span class="p">(</span><span class="kt">float</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">range_start</span> <span class="o">&gt;</span> <span class="n">range_end</span> <span class="o">&amp;&amp;</span> <span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">i</span><span class="o">=</span><span class="n">range_start</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">range_end</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="n">dx</span><span class="p">){</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="o">*</span><span class="n">map</span><span class="p">)(</span><span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">sinData</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">cosData</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">tanData</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">logData</span><span class="p">;</span>
    <span class="n">map_range_to_vec_vbo</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="n">sinData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sinf</span><span class="p">);</span>
    <span class="n">map_range_to_vec_vbo</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="n">cosData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cosf</span><span class="p">);</span>
    <span class="n">map_range_to_vec_vbo</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="n">tanData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tanf</span><span class="p">);</span>
    <span class="n">map_range_to_vec_vbo</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="n">logData</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">log10f</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Plotting Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="cm">/* Create several plot objects which creates the necessary</span>
<span class="cm">     * vertex buffer objects to hold the different plot types</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt0</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">sinData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span> <span class="c1">//create a default plot</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt1</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">cosData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_NONE</span><span class="p">);</span> <span class="c1">//or specify a specific plot type</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt2</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">tanData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_TRIANGLE</span><span class="p">);</span> <span class="c1">//last parameter specifies marker shape</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt3</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)(</span><span class="n">logData</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_SCATTER</span><span class="p">,</span> <span class="n">FG_MARKER_CROSS</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * Set plot colors</span>
<span class="cm">     */</span>
    <span class="n">plt0</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_RED</span><span class="p">);</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_BLUE</span><span class="p">);</span>
    <span class="n">plt2</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>            <span class="c1">//use a forge predefined color</span>
    <span class="n">plt3</span><span class="p">.</span><span class="n">setColor</span><span class="p">((</span><span class="n">forge</span><span class="o">::</span><span class="n">Color</span><span class="p">)</span> <span class="mh">0x257973FF</span><span class="p">);</span>  <span class="c1">//or any hex-valued color</span>
    <span class="cm">/*</span>
<span class="cm">     * Set plot legends</span>
<span class="cm">     */</span>
    <span class="n">plt0</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Sine&quot;</span><span class="p">);</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Cosine&quot;</span><span class="p">);</span>
    <span class="n">plt2</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Tangent&quot;</span><span class="p">);</span>
    <span class="n">plt3</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Log base 10&quot;</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plt0</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plt1</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plt3</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="cm">/* copy your data into the pixel buffer object exposed by</span>
<span class="cm">     * forge::Plot class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">sinData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt0</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">cosData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt1</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">tanData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">logData</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">plt3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id14">
<h3>CUDA<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuda_runtime.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuComplex.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CUDA_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>    <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>    <span class="n">FRANGE_START</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span>    <span class="n">FRANGE_END</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">3.141592f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">size_t</span>   <span class="n">DATA_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)((</span> <span class="n">FRANGE_END</span> <span class="o">-</span> <span class="n">FRANGE_START</span> <span class="p">)</span> <span class="o">/</span> <span class="n">dx</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">,</span> <span class="kt">int</span> <span class="n">functionCode</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">sin_out</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">cos_out</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">tan_out</span><span class="p">;</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">log_out</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Plotting Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

    <span class="cm">/* Create several plot objects which creates the necessary</span>
<span class="cm">     * vertex buffer objects to hold the different plot types</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt0</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>                                 <span class="c1">//create a default plot</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt1</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_NONE</span><span class="p">);</span>       <span class="c1">//or specify a specific plot type</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt2</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_TRIANGLE</span><span class="p">);</span>   <span class="c1">//last parameter specifies marker shape</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt3</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span> <span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_SCATTER</span><span class="p">,</span> <span class="n">FG_MARKER_CROSS</span><span class="p">);</span>

    <span class="cm">/*</span>
<span class="cm">     * Set plot colors</span>
<span class="cm">     */</span>
    <span class="n">plt0</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_RED</span><span class="p">);</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_BLUE</span><span class="p">);</span>
    <span class="n">plt2</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>            <span class="c1">//use a forge predefined color</span>
    <span class="n">plt3</span><span class="p">.</span><span class="n">setColor</span><span class="p">((</span><span class="n">forge</span><span class="o">::</span><span class="n">Color</span><span class="p">)</span> <span class="mh">0x257973FF</span><span class="p">);</span>  <span class="c1">//or any hex-valued color</span>
    <span class="cm">/*</span>
<span class="cm">     * Set plot legends</span>
<span class="cm">     */</span>
    <span class="n">plt0</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Sine&quot;</span><span class="p">);</span>
    <span class="n">plt1</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Cosine&quot;</span><span class="p">);</span>
    <span class="n">plt2</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Tangent&quot;</span><span class="p">);</span>
    <span class="n">plt3</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Log base 10&quot;</span><span class="p">);</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sin_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">cos_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tan_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">log_out</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>

    <span class="n">kernel</span><span class="p">(</span><span class="n">sin_out</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">kernel</span><span class="p">(</span><span class="n">cos_out</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">kernel</span><span class="p">(</span><span class="n">tan_out</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">kernel</span><span class="p">(</span><span class="n">log_out</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plt0</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plt1</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plt3</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="cm">/* copy your data into the vertex buffer object exposed by</span>
<span class="cm">     * forge::Plot class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">sin_out</span><span class="p">,</span> <span class="n">plt0</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">cos_out</span><span class="p">,</span> <span class="n">plt1</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">tan_out</span><span class="p">,</span> <span class="n">plt2</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">log_out</span><span class="p">,</span> <span class="n">plt3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">sin_out</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">cos_out</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">tan_out</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">log_out</span><span class="p">));</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">simple_sinf</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">_data_size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fnCode</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">_dx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">_frange_start</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">_data_size</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">float</span> <span class="n">x</span>  <span class="o">=</span> <span class="n">_frange_start</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">_dx</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">idx</span>  <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>

        <span class="k">switch</span><span class="p">(</span><span class="n">fnCode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
                <span class="n">out</span><span class="p">[</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">sinf</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
                <span class="n">out</span><span class="p">[</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">cosf</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
                <span class="n">out</span><span class="p">[</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">tanf</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
                <span class="n">out</span><span class="p">[</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">log10f</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">,</span> <span class="kt">int</span> <span class="n">functionCode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="n">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="mi">1024</span><span class="p">));</span>

    <span class="n">simple_sinf</span> <span class="o">&lt;&lt;</span> <span class="o">&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">functionCode</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">FRANGE_START</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id15">
<h3>OpenCL<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cl_helpers.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;mutex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">cl</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span>    <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span>    <span class="n">FRANGE_START</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span>    <span class="n">FRANGE_END</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">3.141592f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DATA_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)((</span> <span class="n">FRANGE_END</span> <span class="o">-</span> <span class="n">FRANGE_START</span> <span class="p">)</span> <span class="o">/</span> <span class="n">dx</span><span class="p">);</span>

<span class="cp">#define USE_FORGE_OPENCL_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sinf_ocl_kernel</span> <span class="o">=</span> <span class="sa">R</span><span class="s">&quot;</span><span class="dl">(</span><span class="s"></span>
<span class="s">kernel void sinf(global float* out, const float dx, const unsigned DATA_SIZE, int fnCode)</span>
<span class="s">{</span>
<span class="s">    unsigned x = get_global_id(0);</span>
<span class="s">    if(x &lt; DATA_SIZE) {</span>
<span class="s">        out[2 * x] = x * dx ;</span>
<span class="s">        switch(fnCode) {</span>
<span class="s">            case 0:</span>
<span class="s">                out[ 2 * x + 1 ] = sin(x*dx);</span>
<span class="s">                break;</span>
<span class="s">            case 1:</span>
<span class="s">                out[ 2 * x + 1 ] = cos(x*dx);</span>
<span class="s">                break;</span>
<span class="s">            case 2:</span>
<span class="s">                out[ 2 * x + 1 ] = tan(x*dx);</span>
<span class="s">                break;</span>
<span class="s">            case 3:</span>
<span class="s">                out[ 2 * x + 1 ] = log10(x*dx);</span>
<span class="s">                break;</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="dl">)</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">devOut</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="o">&amp;</span> <span class="n">queue</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fnCode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">once_flag</span>   <span class="n">compileFlag</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span>      <span class="n">prog</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>       <span class="n">kern</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="n">call_once</span><span class="p">(</span><span class="n">compileFlag</span><span class="p">,</span>
        <span class="p">[</span><span class="n">queue</span><span class="p">]()</span> <span class="p">{</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_QUEUE_CONTEXT</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">sinf_ocl_kernel</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
            <span class="n">kern</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;sinf&quot;</span><span class="p">);</span>
        <span class="p">});</span>

    <span class="k">static</span> <span class="k">const</span> <span class="n">NDRange</span> <span class="n">global</span><span class="p">(</span><span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>

    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devOut</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dx</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">DATA_SIZE</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">fnCode</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>

        <span class="cm">/*</span>
<span class="cm">        * First Forge call should be a window creation call</span>
<span class="cm">        * so that necessary OpenGL context is created for any</span>
<span class="cm">        * other forge::* object to be created successfully</span>
<span class="cm">        */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;Plotting Demo&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_2D</span><span class="p">);</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">FRANGE_START</span><span class="p">,</span> <span class="n">FRANGE_END</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">);</span>

        <span class="cm">/* Create several plot objects which creates the necessary</span>
<span class="cm">         * vertex buffer objects to hold the different plot types</span>
<span class="cm">         */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt0</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>                                 <span class="c1">//create a default plot</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt1</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_NONE</span><span class="p">);</span>       <span class="c1">//or specify a specific plot type</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt2</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_LINE</span><span class="p">,</span> <span class="n">FG_MARKER_TRIANGLE</span><span class="p">);</span>   <span class="c1">//last parameter specifies marker shape</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Plot</span> <span class="n">plt3</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DATA_SIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">,</span> <span class="n">FG_PLOT_SCATTER</span><span class="p">,</span> <span class="n">FG_MARKER_CROSS</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Set plot colors</span>
<span class="cm">         */</span>
        <span class="n">plt0</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_RED</span><span class="p">);</span>
        <span class="n">plt1</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_BLUE</span><span class="p">);</span>
        <span class="n">plt2</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>            <span class="c1">//use a forge predefined color</span>
        <span class="n">plt3</span><span class="p">.</span><span class="n">setColor</span><span class="p">((</span><span class="n">forge</span><span class="o">::</span><span class="n">Color</span><span class="p">)</span> <span class="mh">0x257973FF</span><span class="p">);</span>  <span class="c1">//or any hex-valued color</span>
        <span class="cm">/*</span>
<span class="cm">         * Set plot legends</span>
<span class="cm">         */</span>
        <span class="n">plt0</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Sine&quot;</span><span class="p">);</span>
        <span class="n">plt1</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Cosine&quot;</span><span class="p">);</span>
        <span class="n">plt2</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Tangent&quot;</span><span class="p">);</span>
        <span class="n">plt3</span><span class="p">.</span><span class="n">setLegend</span><span class="p">(</span><span class="s">&quot;Log base 10&quot;</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Helper function to create a CLGL interop context.</span>
<span class="cm">         * This function checks for if the extension is available</span>
<span class="cm">         * and creates the context on the appropriate device.</span>
<span class="cm">         * Note: context and queue are defined in cl_helpers.h</span>
<span class="cm">         */</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">createCLGLContext</span><span class="p">(</span><span class="n">wnd</span><span class="p">);</span>
        <span class="n">Device</span> <span class="n">device</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_CONTEXT_DEVICES</span><span class="o">&gt;</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">sinOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">cosOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">tanOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">logOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">DATA_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">kernel</span><span class="p">(</span><span class="n">sinOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">kernel</span><span class="p">(</span><span class="n">cosOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">kernel</span><span class="p">(</span><span class="n">tanOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">kernel</span><span class="p">(</span><span class="n">logOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

        <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plt0</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">plt1</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">plt2</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">plt3</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="cm">/* copy your data into the vertex buffer object exposed by</span>
<span class="cm">         * forge::Plot class and then proceed to rendering.</span>
<span class="cm">         * To help the users with copying the data from compute</span>
<span class="cm">         * memory to display memory, Forge provides copy headers</span>
<span class="cm">         * along with the library to help with this task</span>
<span class="cm">         */</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">sinOut</span><span class="p">(),</span> <span class="n">plt0</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">cosOut</span><span class="p">(),</span> <span class="n">plt1</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">tanOut</span><span class="p">(),</span> <span class="n">plt2</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">logOut</span><span class="p">(),</span> <span class="n">plt3</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">forge</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="d-vector-stream">
<h2>3D Vector Stream<a class="headerlink" href="#d-vector-stream" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id16">
<h3>CPU<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CPU_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265359f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MINIMUM</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MAXIMUM</span> <span class="o">=</span> <span class="mf">20.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">STEP</span>    <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">NELEMS</span>    <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">MAXIMUM</span><span class="o">-</span><span class="n">MINIMUM</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">STEP</span><span class="p">);</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">generateColors</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span> <span class="n">colors</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">AF_BLUE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0588f</span> <span class="p">,</span> <span class="mf">0.1137f</span> <span class="p">,</span> <span class="mf">0.2745f</span> <span class="p">,</span> <span class="mf">1.0f</span><span class="p">};</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">AF_ORANGE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.8588f</span> <span class="p">,</span> <span class="mf">0.6137f</span> <span class="p">,</span> <span class="mf">0.0745f</span> <span class="p">,</span> <span class="mf">1.0f</span><span class="p">};</span>

    <span class="kt">int</span> <span class="n">numElems</span> <span class="o">=</span> <span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">;</span>
    <span class="n">colors</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">numElems</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">AF_ORANGE</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">AF_ORANGE</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
            <span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">AF_ORANGE</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">AF_BLUE</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">AF_BLUE</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
            <span class="n">colors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">AF_BLUE</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">generatePoints</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">points</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">dirs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">points</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">NELEMS</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">MINIMUM</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">STEP</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">NELEMS</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">MINIMUM</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">STEP</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NELEMS</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">MINIMUM</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">STEP</span><span class="p">;</span>
                <span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
                <span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
                <span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>
                <span class="n">dirs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">10.0f</span><span class="p">);</span>
                <span class="n">dirs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="mf">10.0f</span><span class="p">);</span>
                <span class="n">dirs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="mf">10.0f</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;3D Vector Field Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span>
                        <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span>
                        <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">numElems</span> <span class="o">=</span> <span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">;</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">VectorField</span> <span class="n">field</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">vectorField</span><span class="p">(</span><span class="n">numElems</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
    <span class="n">field</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">points</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">colors</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">dirs</span><span class="p">;</span>
    <span class="n">generatePoints</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirs</span><span class="p">);</span>
    <span class="n">generateColors</span><span class="p">(</span><span class="n">colors</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">directions</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">points</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span>   <span class="n">field</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">colors</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span>     <span class="n">field</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dirs</span><span class="p">.</span><span class="n">data</span><span class="p">()</span>  <span class="p">,</span> <span class="n">field</span><span class="p">.</span><span class="n">directionsSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id17">
<h3>CUDA<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuda_runtime.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CUDA_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MINIMUM</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MAXIMUM</span> <span class="o">=</span> <span class="mf">20.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">STEP</span>    <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">NELEMS</span>    <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">MAXIMUM</span><span class="o">-</span><span class="n">MINIMUM</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">STEP</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">generateColors</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">colors</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">generatePoints</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">points</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dirs</span><span class="p">);</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;3D Vector Field Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span>
                        <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span>
                        <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">numElems</span> <span class="o">=</span> <span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">;</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">VectorField</span> <span class="n">field</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">vectorField</span><span class="p">(</span><span class="n">numElems</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
    <span class="n">field</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>

    <span class="kt">float</span><span class="o">*</span> <span class="n">points</span><span class="p">;</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">colors</span><span class="p">;</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">dirs</span><span class="p">;</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">points</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">numElems</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">colors</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">numElems</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dirs</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">numElems</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>

    <span class="n">generatePoints</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirs</span><span class="p">);</span>
    <span class="n">generateColors</span><span class="p">(</span><span class="n">colors</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">directions</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">points</span><span class="p">,</span> <span class="n">field</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">colors</span><span class="p">,</span>   <span class="n">field</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dirs</span><span class="p">,</span> <span class="n">field</span><span class="p">.</span><span class="n">directionsSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">points</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">colors</span><span class="p">));</span>
    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">dirs</span><span class="p">));</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">genColorsKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">colors</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nelems</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">AF_BLUE</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0588f</span> <span class="p">,</span> <span class="mf">0.1137f</span> <span class="p">,</span> <span class="mf">0.2745f</span> <span class="p">,</span> <span class="mf">1.0f</span><span class="p">};</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">AF_ORANGE</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.8588f</span> <span class="p">,</span> <span class="mf">0.6137f</span> <span class="p">,</span> <span class="mf">0.0745f</span> <span class="p">,</span> <span class="mf">1.0f</span><span class="p">};</span>

    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nelems</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">AF_ORANGE</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AF_ORANGE</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">AF_ORANGE</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">AF_BLUE</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AF_BLUE</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">AF_BLUE</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">generateColors</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">colors</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">numElems</span> <span class="o">=</span> <span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">512</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="n">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">numElems</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">x</span><span class="p">));</span>

    <span class="n">genColorsKernel</span><span class="o">&lt;&lt;&lt;</span><span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span><span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">numElems</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">pointGenKernel</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">points</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dirs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nBBS0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nelems</span><span class="p">,</span> <span class="kt">float</span> <span class="n">minimum</span><span class="p">,</span> <span class="kt">float</span> <span class="n">step</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">nBBS0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">nBBS0</span><span class="p">)</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">nelems</span> <span class="o">&amp;&amp;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nelems</span> <span class="o">&amp;&amp;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">nelems</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">minimum</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">step</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">minimum</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">step</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">minimum</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">step</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">nelems</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">nelems</span><span class="o">*</span><span class="n">nelems</span><span class="p">;</span>

        <span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
        <span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span><span class="p">;</span>

        <span class="n">dirs</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="mf">10.f</span><span class="p">;</span>
        <span class="n">dirs</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="mf">10.f</span><span class="p">;</span>
        <span class="n">dirs</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">id</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span><span class="o">-</span><span class="mf">10.f</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">generatePoints</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">points</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dirs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">blk_x</span> <span class="o">=</span> <span class="n">divup</span><span class="p">(</span><span class="n">NELEMS</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">blk_y</span> <span class="o">=</span> <span class="n">divup</span><span class="p">(</span><span class="n">NELEMS</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

    <span class="n">dim3</span> <span class="n">blocks</span><span class="p">(</span><span class="n">blk_x</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">,</span> <span class="n">blk_y</span><span class="p">);</span>

    <span class="n">pointGenKernel</span><span class="o">&lt;&lt;&lt;</span><span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span><span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">blk_x</span><span class="p">,</span> <span class="n">NELEMS</span><span class="p">,</span> <span class="n">MINIMUM</span><span class="p">,</span> <span class="n">STEP</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id18">
<h3>OpenCL<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cl_helpers.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ctime&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">cl</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMX</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">DIMY</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MINIMUM</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MAXIMUM</span> <span class="o">=</span> <span class="mf">20.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">STEP</span>    <span class="o">=</span> <span class="mf">2.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">NELEMS</span>    <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">MAXIMUM</span><span class="o">-</span><span class="n">MINIMUM</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">STEP</span><span class="p">);</span>

<span class="cp">#define USE_FORGE_OPENCL_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">streamKernel</span> <span class="o">=</span>
<span class="sa">R</span><span class="s">&quot;</span><span class="dl">EOK(</span><span class="s"></span>
<span class="s">constant float AF_BLUE[4] = {0.0588f , 0.1137f , 0.2745f , 1.0f};</span>
<span class="s">constant float AF_ORANGE[4] = {0.8588f , 0.6137f , 0.0745f , 1.0f};</span>

<span class="s">kernel</span>
<span class="s">void genColorsKernel(global float* colors, int NELEMS)</span>
<span class="s">{</span>
<span class="s">    const size_t nelems = NELEMS * NELEMS * NELEMS;</span>

<span class="s">    int i = get_global_id(0);</span>

<span class="s">    if (i&lt;nelems) {</span>
<span class="s">        if (i%2==0) {</span>
<span class="s">            colors[3*i+0] = AF_ORANGE[0];</span>
<span class="s">            colors[3*i+1] = AF_ORANGE[1];</span>
<span class="s">            colors[3*i+2] = AF_ORANGE[2];</span>
<span class="s">        } else {</span>
<span class="s">            colors[3*i+0] = AF_BLUE[0];</span>
<span class="s">            colors[3*i+1] = AF_BLUE[1];</span>
<span class="s">            colors[3*i+2] = AF_BLUE[2];</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">kernel</span>
<span class="s">void pointGenKernel(global float* points, global float* dirs, int nBBS0,</span>
<span class="s">                    int NELEMS, float MINIMUM, float STEP)</span>
<span class="s">{</span>
<span class="s">    int k = get_group_id(0) / nBBS0;</span>
<span class="s">    int i = get_local_size(0) * (get_group_id(0)-k*nBBS0) + get_local_id(0);</span>
<span class="s">    int j = get_global_id(1);</span>

<span class="s">    if (i&lt;NELEMS &amp;&amp; j&lt;NELEMS &amp;&amp; k&lt;NELEMS) {</span>
<span class="s">        float x = MINIMUM + i*STEP;</span>
<span class="s">        float y = MINIMUM + j*STEP;</span>
<span class="s">        float z = MINIMUM + k*STEP;</span>

<span class="s">        int id = i + j * NELEMS + k * NELEMS*NELEMS;</span>

<span class="s">        points[3*id+0] = x;</span>
<span class="s">        points[3*id+1] = y;</span>
<span class="s">        points[3*id+2] = z;</span>

<span class="s">        dirs[3*id+0] = x-10.f;</span>
<span class="s">        dirs[3*id+1] = y-10.f;</span>
<span class="s">        dirs[3*id+2] = z-10.f;</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="dl">)EOK</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kr">inline</span> <span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">generatePoints</span><span class="p">(</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">points</span><span class="p">,</span> <span class="n">Buffer</span> <span class="o">&amp;</span><span class="n">dirs</span><span class="p">,</span> <span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">colors</span><span class="p">,</span>
                    <span class="n">CommandQueue</span><span class="o">&amp;</span> <span class="n">queue</span><span class="p">,</span> <span class="n">Device</span><span class="o">&amp;</span> <span class="n">device</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span> <span class="n">prog</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>  <span class="n">pointGenKernel</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>  <span class="n">colorsKernel</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">compileFlag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_QUEUE_CONTEXT</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">streamKernel</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cl</span><span class="o">::</span><span class="n">Device</span><span class="o">&gt;</span> <span class="n">devs</span><span class="p">;</span>
            <span class="n">devs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
            <span class="n">prog</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">devs</span><span class="p">);</span>

            <span class="n">pointGenKernel</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;pointGenKernel&quot;</span><span class="p">);</span>
            <span class="n">colorsKernel</span>   <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;genColorsKernel&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Compile Errors: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">prog</span><span class="p">.</span><span class="n">getBuildInfo</span><span class="o">&lt;</span><span class="n">CL_PROGRAM_BUILD_LOG</span><span class="o">&gt;</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&quot;Kernels compiled successfully&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">const</span> <span class="n">NDRange</span> <span class="n">local</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">blk_x</span> <span class="o">=</span> <span class="n">divup</span><span class="p">(</span><span class="n">NELEMS</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
    <span class="kt">int</span> <span class="n">blk_y</span> <span class="o">=</span> <span class="n">divup</span><span class="p">(</span><span class="n">NELEMS</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>

    <span class="n">NDRange</span> <span class="n">global</span><span class="p">(</span><span class="n">NELEMS</span> <span class="o">*</span> <span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">blk_x</span><span class="p">,</span> <span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">blk_y</span><span class="p">);</span>

    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">points</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dirs</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">blk_x</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">NELEMS</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">MINIMUM</span><span class="p">);</span>
    <span class="n">pointGenKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">STEP</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">pointGenKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">numElems</span> <span class="o">=</span> <span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">;</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">NDRange</span> <span class="n">thrds</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">NDRange</span> <span class="n">glob</span><span class="p">(</span><span class="n">thrds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">divup</span><span class="p">(</span><span class="n">numElems</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">thrds</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">thrds</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>

    <span class="n">colorsKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">colors</span><span class="p">);</span>
    <span class="n">colorsKernel</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">NELEMS</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">colorsKernel</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">glob</span><span class="p">,</span> <span class="n">thrds</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">         * First Forge call should be a window creation call</span>
<span class="cm">         * so that necessary OpenGL context is created for any</span>
<span class="cm">         * other forge::* object to be created successfully</span>
<span class="cm">         */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="n">DIMX</span><span class="p">,</span> <span class="n">DIMY</span><span class="p">,</span> <span class="s">&quot;3D Vector Field Demo&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span>
                            <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">,</span>
                            <span class="n">MINIMUM</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="n">MAXIMUM</span><span class="p">);</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

        <span class="kt">int</span> <span class="n">numElems</span> <span class="o">=</span> <span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="o">*</span><span class="n">NELEMS</span><span class="p">;</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">VectorField</span> <span class="n">field</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">vectorField</span><span class="p">(</span><span class="n">numElems</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
        <span class="n">field</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Helper function to create a CLGL interop context.</span>
<span class="cm">         * This function checks for if the extension is available</span>
<span class="cm">         * and creates the context on the appropriate device.</span>
<span class="cm">         * Note: context and queue are defined in cl_helpers.h</span>
<span class="cm">         */</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">createCLGLContext</span><span class="p">(</span><span class="n">wnd</span><span class="p">);</span>
        <span class="n">Device</span> <span class="n">device</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_CONTEXT_DEVICES</span><span class="o">&gt;</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">points</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">numElems</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">colors</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">numElems</span><span class="p">);</span>
        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">dirs</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">numElems</span><span class="p">);</span>

        <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">field</span><span class="p">.</span><span class="n">directions</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

        <span class="n">generatePoints</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">points</span><span class="p">(),</span> <span class="n">field</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">colors</span><span class="p">(),</span>   <span class="n">field</span><span class="p">.</span><span class="n">colorsSize</span><span class="p">());</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dirs</span><span class="p">(),</span> <span class="n">field</span><span class="p">.</span><span class="n">directionsSize</span><span class="p">());</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">forge</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="surfaces">
<h2>Surfaces<a class="headerlink" href="#surfaces" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id19">
<h3>CPU<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CPU_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">XMIN</span> <span class="o">=</span> <span class="o">-</span><span class="mf">32.0f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">XMAX</span> <span class="o">=</span>  <span class="mf">32.0f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">YMIN</span> <span class="o">=</span> <span class="o">-</span><span class="mf">32.0f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">YMAX</span> <span class="o">=</span>  <span class="mf">32.0f</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">DX</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">XSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)((</span><span class="n">XMAX</span><span class="o">-</span><span class="n">XMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">YSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)((</span><span class="n">YMAX</span><span class="o">-</span><span class="n">YMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">genSurface</span><span class="p">(</span><span class="kt">float</span> <span class="n">dx</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">vec</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">vec</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">=</span><span class="n">XMIN</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">XMAX</span><span class="p">;</span> <span class="n">x</span><span class="o">+=</span><span class="n">dx</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">y</span><span class="o">=</span><span class="n">YMIN</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">YMAX</span><span class="p">;</span> <span class="n">y</span><span class="o">+=</span><span class="n">dx</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
            <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
            <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.2204e-16</span><span class="n">f</span><span class="p">;</span>
            <span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="n">z</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="s">&quot;3d Surface Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="n">XMIN</span><span class="o">-</span><span class="mf">2.0f</span><span class="p">,</span> <span class="n">XMAX</span><span class="o">+</span><span class="mf">2.0f</span><span class="p">,</span> <span class="n">YMIN</span><span class="o">-</span><span class="mf">2.0f</span><span class="p">,</span> <span class="n">YMAX</span><span class="o">+</span><span class="mf">2.0f</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Surface</span> <span class="n">surf</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">surface</span><span class="p">(</span><span class="n">XSIZE</span><span class="p">,</span> <span class="n">YSIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
    <span class="n">surf</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>

    <span class="c1">//generate a surface</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">function</span><span class="p">;</span>

    <span class="n">genSurface</span><span class="p">(</span><span class="n">DX</span><span class="p">,</span> <span class="n">function</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span><span class="p">;</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">surf</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>

    <span class="cm">/* copy your data into the pixel buffer object exposed by</span>
<span class="cm">     * forge::Plot class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">function</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">surf</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id20">
<h3>CUDA<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuda_runtime.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cuComplex.h&gt;</span><span class="cp"></span>
<span class="cp">#define USE_FORGE_CUDA_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">XMIN</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">XMAX</span> <span class="o">=</span> <span class="mf">8.f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">YMIN</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">YMAX</span> <span class="o">=</span> <span class="mf">8.f</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">DX</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">XSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)((</span><span class="n">XMAX</span><span class="o">-</span><span class="n">XMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">size_t</span> <span class="n">YSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)((</span><span class="n">YMAX</span><span class="o">-</span><span class="n">YMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">float</span> <span class="n">dx</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">dev_out</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * First Forge call should be a window creation call</span>
<span class="cm">     * so that necessary OpenGL context is created for any</span>
<span class="cm">     * other forge::* object to be created successfully</span>
<span class="cm">     */</span>
    <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="s">&quot;3d Surface Demo&quot;</span><span class="p">);</span>
    <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="o">-</span><span class="mf">10.f</span><span class="p">,</span> <span class="mf">10.f</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.f</span><span class="p">,</span> <span class="mf">10.f</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>
    <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

    <span class="n">forge</span><span class="o">::</span><span class="n">Surface</span> <span class="n">surf</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">surface</span><span class="p">(</span><span class="n">XSIZE</span><span class="p">,</span> <span class="n">YSIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
    <span class="n">surf</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaMalloc</span><span class="p">((</span><span class="kt">void</span><span class="o">**</span><span class="p">)</span><span class="o">&amp;</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">XSIZE</span> <span class="o">*</span> <span class="n">YSIZE</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="p">));</span>
    <span class="n">kernel</span><span class="p">(</span><span class="n">DX</span><span class="p">,</span> <span class="n">dev_out</span><span class="p">);</span>

    <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span><span class="p">;</span>
    <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">surf</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
    <span class="cm">/* copy your data into the vertex buffer object exposed by</span>
<span class="cm">     * forge::Plot class and then proceed to rendering.</span>
<span class="cm">     * To help the users with copying the data from compute</span>
<span class="cm">     * memory to display memory, Forge provides copy headers</span>
<span class="cm">     * along with the library to help with this task</span>
<span class="cm">     */</span>
    <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">dev_out</span><span class="p">,</span> <span class="n">surf</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

    <span class="k">do</span> <span class="p">{</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

    <span class="n">FORGE_CUDA_CHECK</span><span class="p">(</span><span class="n">cudaFree</span><span class="p">(</span><span class="n">dev_out</span><span class="p">));</span>
    <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


    <span class="n">__global__</span>
<span class="kt">void</span> <span class="nf">sincos_surf</span><span class="p">(</span><span class="kt">float</span> <span class="n">dx</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">out</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">float</span> <span class="n">XMIN</span><span class="p">,</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">YMIN</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">size_t</span> <span class="n">XSIZE</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">YSIZE</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">x</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">blockIdx</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">blockDim</span><span class="p">.</span><span class="n">y</span>  <span class="o">+</span> <span class="n">threadIdx</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">x</span><span class="o">=</span> <span class="n">XMIN</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">dx</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">y</span><span class="o">=</span> <span class="n">YMIN</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">dx</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">XSIZE</span> <span class="o">&amp;&amp;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">YSIZE</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">YSIZE</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">offset</span>     <span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.2204e-16</span><span class="p">;</span>
        <span class="n">out</span><span class="p">[</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">]</span> <span class="o">=</span> <span class="n">sinf</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="n">z</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

    <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="kt">float</span> <span class="n">dx</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">dev_out</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="n">dim3</span> <span class="n">threads</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">dim3</span> <span class="n">blocks</span><span class="p">(</span><span class="n">divup</span><span class="p">(</span><span class="n">XSIZE</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
            <span class="n">divup</span><span class="p">(</span><span class="n">YSIZE</span><span class="p">,</span> <span class="n">threads</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>

    <span class="n">sincos_surf</span><span class="o">&lt;&lt;&lt;</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">threads</span> <span class="o">&gt;&gt;&gt;</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dev_out</span><span class="p">,</span> <span class="n">XMIN</span><span class="p">,</span> <span class="n">YMIN</span><span class="p">,</span> <span class="n">XSIZE</span><span class="p">,</span> <span class="n">YSIZE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id21">
<h3>OpenCL<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*******************************************************</span>
<span class="cm"> * Copyright (c) 2015-2019, ArrayFire</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed under 3-clause BSD license.</span>
<span class="cm"> * The complete license agreement can be obtained at:</span>
<span class="cm"> * http://arrayfire.com/licenses/BSD-3-Clause</span>
<span class="cm"> ********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;forge.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cl_helpers.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;mutex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;complex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">XMIN</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">XMAX</span> <span class="o">=</span> <span class="mf">8.f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">YMIN</span> <span class="o">=</span> <span class="o">-</span><span class="mf">8.0f</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">YMAX</span> <span class="o">=</span> <span class="mf">8.f</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">float</span> <span class="n">DX</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">XSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)((</span><span class="n">XMAX</span><span class="o">-</span><span class="n">XMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">YSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)((</span><span class="n">YMAX</span><span class="o">-</span><span class="n">YMIN</span><span class="p">)</span><span class="o">/</span><span class="n">DX</span><span class="p">);</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="cp">#define USE_FORGE_OPENCL_COPY_HELPERS</span>
<span class="cp">#include</span> <span class="cpf">&lt;ComputeCopy.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">sin_surf_kernel</span> <span class="o">=</span>
<span class="sa">R</span><span class="s">&quot;</span><span class="dl">EOK(</span><span class="s"></span>
<span class="s">kernel</span>
<span class="s">void surf(global float* out, const float dx,</span>
<span class="s">          const float xmin, const float ymin,</span>
<span class="s">          const unsigned w, const unsigned h)</span>
<span class="s">{</span>
<span class="s">    int i = get_global_id(0);</span>
<span class="s">    int j = get_global_id(1);</span>

<span class="s">    float x = xmin + i*dx;</span>
<span class="s">    float y = ymin + j*dx;</span>

<span class="s">    if (i&lt;w &amp;&amp; j&lt;h) {</span>
<span class="s">        int offset = j + i * h;</span>
<span class="s">        out[ 3 * offset     ] = x;</span>
<span class="s">        out[ 3 * offset + 1 ] = y;</span>
<span class="s">        float z = sqrt(x*x+y*y) + 2.2204e-16;</span>
<span class="s">        out[ 3 * offset + 2 ] = sin(z)/z;</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="dl">)EOK</span><span class="s">&quot;</span><span class="p">;</span>

<span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">divup</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">kernel</span><span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span><span class="o">&amp;</span> <span class="n">devOut</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span><span class="o">&amp;</span> <span class="n">queue</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">Device</span><span class="o">&amp;</span> <span class="n">device</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span> <span class="n">prog</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span>  <span class="n">kern</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">compileFlag</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_QUEUE_CONTEXT</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">sin_surf_kernel</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cl</span><span class="o">::</span><span class="n">Device</span><span class="o">&gt;</span> <span class="n">devs</span><span class="p">;</span>
            <span class="n">devs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
            <span class="n">prog</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">devs</span><span class="p">);</span>

            <span class="n">kern</span> <span class="o">=</span> <span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="s">&quot;surf&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Compile Errors: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">prog</span><span class="p">.</span><span class="n">getBuildInfo</span><span class="o">&lt;</span><span class="n">CL_PROGRAM_BUILD_LOG</span><span class="o">&gt;</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span> <span class="s">&quot;Kernels compiled successfully&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">compileFlag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">NDRange</span> <span class="n">local</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">NDRange</span> <span class="n">global</span><span class="p">(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">divup</span><span class="p">(</span><span class="n">XSIZE</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                   <span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">divup</span><span class="p">(</span><span class="n">YSIZE</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">local</span><span class="p">[</span><span class="mi">1</span><span class="p">])));</span>

    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devOut</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">DX</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">XMIN</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">YMIN</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">XSIZE</span><span class="p">);</span>
    <span class="n">kern</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">YSIZE</span><span class="p">);</span>
    <span class="n">queue</span><span class="p">.</span><span class="n">enqueueNDRangeKernel</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">cl</span><span class="o">::</span><span class="n">NullRange</span><span class="p">,</span> <span class="n">global</span><span class="p">,</span> <span class="n">local</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>

        <span class="cm">/*</span>
<span class="cm">         * First Forge call should be a window creation call</span>
<span class="cm">         * so that necessary OpenGL context is created for any</span>
<span class="cm">         * other forge::* object to be created successfully</span>
<span class="cm">         */</span>
        <span class="n">forge</span><span class="o">::</span><span class="n">Window</span> <span class="n">wnd</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="s">&quot;3d Surface Demo&quot;</span><span class="p">);</span>
        <span class="n">wnd</span><span class="p">.</span><span class="n">makeCurrent</span><span class="p">();</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Chart</span> <span class="n">chart</span><span class="p">(</span><span class="n">FG_CHART_3D</span><span class="p">);</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesLimits</span><span class="p">(</span><span class="o">-</span><span class="mf">10.f</span><span class="p">,</span> <span class="mf">10.f</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.f</span><span class="p">,</span> <span class="mf">10.f</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>
        <span class="n">chart</span><span class="p">.</span><span class="n">setAxesTitles</span><span class="p">(</span><span class="s">&quot;x-axis&quot;</span><span class="p">,</span> <span class="s">&quot;y-axis&quot;</span><span class="p">,</span> <span class="s">&quot;z-axis&quot;</span><span class="p">);</span>

        <span class="n">forge</span><span class="o">::</span><span class="n">Surface</span> <span class="n">surf</span> <span class="o">=</span> <span class="n">chart</span><span class="p">.</span><span class="n">surface</span><span class="p">(</span><span class="n">XSIZE</span><span class="p">,</span> <span class="n">YSIZE</span><span class="p">,</span> <span class="n">forge</span><span class="o">::</span><span class="n">f32</span><span class="p">);</span>
        <span class="n">surf</span><span class="p">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">FG_YELLOW</span><span class="p">);</span>

        <span class="cm">/*</span>
<span class="cm">         * Helper function to create a CLGL interop context.</span>
<span class="cm">         * This function checks for if the extension is available</span>
<span class="cm">         * and creates the context on the appropriate device.</span>
<span class="cm">         * Note: context and queue are defined in cl_helpers.h</span>
<span class="cm">         */</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">createCLGLContext</span><span class="p">(</span><span class="n">wnd</span><span class="p">);</span>
        <span class="n">Device</span> <span class="n">device</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_CONTEXT_DEVICES</span><span class="o">&gt;</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">devOut</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_READ_WRITE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">XSIZE</span> <span class="o">*</span> <span class="n">YSIZE</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>

        <span class="n">kernel</span><span class="p">(</span><span class="n">devOut</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>

        <span class="n">GfxHandle</span><span class="o">*</span> <span class="n">handle</span><span class="p">;</span>
        <span class="n">createGLBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">,</span> <span class="n">surf</span><span class="p">.</span><span class="n">vertices</span><span class="p">(),</span> <span class="n">FORGE_VERTEX_BUFFER</span><span class="p">);</span>
        <span class="cm">/* copy your data into the pixel buffer object exposed by</span>
<span class="cm">         * forge::Surface class and then proceed to rendering.</span>
<span class="cm">         * To help the users with copying the data from compute</span>
<span class="cm">         * memory to display memory, Forge provides copy headers</span>
<span class="cm">         * along with the library to help with this task</span>
<span class="cm">         */</span>
        <span class="n">copyToGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="p">(</span><span class="n">ComputeResourceHandle</span><span class="p">)</span><span class="n">devOut</span><span class="p">(),</span> <span class="n">surf</span><span class="p">.</span><span class="n">verticesSize</span><span class="p">());</span>

        <span class="k">do</span> <span class="p">{</span>
            <span class="n">wnd</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="n">chart</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">wnd</span><span class="p">.</span><span class="n">close</span><span class="p">());</span>

        <span class="n">releaseGLBuffer</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">forge</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">cl</span><span class="o">::</span><span class="n">Error</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">err</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="extras.html" class="btn btn-neutral float-left" title="Interop Helpers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 ArrayFire

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>